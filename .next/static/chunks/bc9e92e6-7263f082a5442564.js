"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[358],{34892:function(e,t,n){n.d(t,{EK:function(){return ee},ET:function(){return op},IO:function(){return a4},JU:function(){return ab},PL:function(){return od},QT:function(){return oh},TQ:function(){return on},Xo:function(){return a8},ad:function(){return aC},b9:function(){return oe},hJ:function(){return aI},oe:function(){return oy},r7:function(){return ov}});var r,i,a,o,u=n(94566),s=n(65789),c=n(18716),l=n(44567),h=n(2929),f=n(7378),d=n(62766),v=n(29589),y=n(85585),p=n(44175),m=n(70751),g=n(83130),k=n.n(g),w=n(91918),_=n(52371),E=n(40458),T=n(10639),I=n(97511),b=n(1260);n(1481);var x=n(39527).Buffer;function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return C(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,void 0)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=(0,v.Z)(e);return n=t?Reflect.construct(r,arguments,(0,v.Z)(this).constructor):r.apply(this,arguments),(0,d.Z)(this,n)}}var N="@firebase/firestore",D=function(){function e(t){(0,p.Z)(this,e),this.uid=t}return(0,m.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */D.UNAUTHENTICATED=new D(null),D.GOOGLE_CREDENTIALS=new D("google-credentials-uid"),D.FIRST_PARTY=new D("first-party-uid"),D.MOCK_USER=new D("mock-user");var Z="10.12.1",R=new E.Yd("@firebase/firestore");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L(){return R.logLevel}function M(e){if(R.logLevel<=E.in.DEBUG){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(O);R.debug.apply(R,["Firestore (".concat(Z,"): ").concat(e)].concat((0,y.Z)(i)))}}function V(e){if(R.logLevel<=E.in.ERROR){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(O);R.error.apply(R,["Firestore (".concat(Z,"): ").concat(e)].concat((0,y.Z)(i)))}}function F(e){if(R.logLevel<=E.in.WARN){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(O);R.warn.apply(R,["Firestore (".concat(Z,"): ").concat(e)].concat((0,y.Z)(i)))}}function O(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(Z,") INTERNAL ASSERTION FAILED: ")+e;throw V(t),Error(t)}var U={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},q=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){var i;return(0,p.Z)(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return(0,m.Z)(n)}(T.ZR),B=(0,m.Z)(function e(){var t=this;(0,p.Z)(this,e),this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}),z=(0,m.Z)(function e(t,n){(0,p.Z)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))}),G=function(){function e(){(0,p.Z)(this,e)}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable(function(){return t(D.UNAUTHENTICATED)})}},{key:"shutdown",value:function(){}}]),e}(),K=function(){function e(t){(0,p.Z)(this,e),this.token=t,this.changeListener=null}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable(function(){return t(n.token.user)})}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),Q=function(){function e(t){(0,p.Z)(this,e),this.t=t,this.currentUser=D.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,m.Z)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new B;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new B,e.enqueueRetryable(function(){return i(n.currentUser)})};var o=function(){var t=a;e.enqueueRetryable((0,h.Z)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}},e)})))},u=function(e){M("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit(function(e){return u(e)}),setTimeout(function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?u(e):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new B)}},0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return e.i!==t?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?("string"==typeof n.accessToken||P(),new z(n.accessToken,e.currentUser)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||P(),new D(e)}}]),e}(),j=function(){function e(t,n,r){(0,p.Z)(this,e),this.l=t,this.h=n,this.P=r,this.type="FirstParty",this.user=D.FIRST_PARTY,this.I=new Map}return(0,m.Z)(e,[{key:"T",value:function(){return this.P?this.P():null}},{key:"headers",get:function(){this.I.set("X-Goog-AuthUser",this.l);var e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}]),e}(),W=function(){function e(t,n,r){(0,p.Z)(this,e),this.l=t,this.h=n,this.P=r}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new j(this.l,this.h,this.P))}},{key:"start",value:function(e,t){e.enqueueRetryable(function(){return t(D.FIRST_PARTY)})}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),H=(0,m.Z)(function e(t){(0,p.Z)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}),Y=function(){function e(t){(0,p.Z)(this,e),this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}return(0,m.Z)(e,[{key:"start",value:function(e,t){var n=this,r=function(e){null!=e.error&&M("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.R;return n.R=e.token,M("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable(function(){return r(t)})};var i=function(e){M("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.A.onInit(function(e){return i(e)}),setTimeout(function(){if(!n.appCheck){var e=n.A.getImmediate({optional:!0});e?i(e):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(function(t){return t?("string"==typeof t.token||P(),e.R=t.token,new H(t.token)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}(),X=function(){function e(){(0,p.Z)(this,e)}return(0,m.Z)(e,null,[{key:"newId",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<40;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(0),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function J(e,t){return e<t?-1:e>t?1:0}function $(e,t,n){return e.length===t.length&&e.every(function(e,r){return n(e,t[r])})}var ee=function(){function e(t,n){if((0,p.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0||n>=1e9)throw new q(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800||t>=253402300800)throw new q(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,m.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),et=function(){function e(t){(0,p.Z)(this,e),this.timestamp=t}return(0,m.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new ee(0,0))}},{key:"max",value:function(){return new e(new ee(253402300799,999999999))}}]),e}(),en=function(){function e(t,n,r){(0,p.Z)(this,e),void 0===n?n=0:n>t.length&&P(),void 0===r?r=t.length-n:r>t.length-n&&P(),this.segments=t,this.offset=n,this.len=r}return(0,m.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(e){n.push(e)}):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return -1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),er=function(e){(0,f.Z)(n,e);var t=S(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"toUriEncodedString",value:function(){return this.toArray().map(encodeURIComponent).join("/")}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0;a<r.length;a++){var o=r[a];if(o.indexOf("//")>=0)throw new q(U.INVALID_ARGUMENT,"Invalid segment (".concat(o,"). Paths must not contain // in them."));e.push.apply(e,(0,y.Z)(o.split("/").filter(function(e){return e.length>0})))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(en),ei=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ea=function(e){(0,f.Z)(n,e);var t=S(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return ei.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new q(U.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},o=!1;i<e.length;){var u=e[i];if("\\"===u){if(i+1===e.length)throw new q(U.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new q(U.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=s,i+=2}else"`"===u?o=!o:"."!==u||o?r+=u:a(),i++}if(a(),o)throw new q(U.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(en),eo=function(){function e(t){(0,p.Z)(this,e),this.path=t}return(0,m.Z)(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===er.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(er.fromString(t))}},{key:"fromName",value:function(t){return new e(er.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e(er.emptyPath())}},{key:"comparator",value:function(e,t){return er.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new er(t.slice()))}}]),e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eu(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new es(et.fromTimestamp(1e9===r?new ee(n+1,0):new ee(n,r)),eo.empty(),t)}(0,m.Z)(function e(t,n,r,i){(0,p.Z)(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i}).UNKNOWN_ID=-1;var es=function(){function e(t,n,r){(0,p.Z)(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return(0,m.Z)(e,null,[{key:"min",value:function(){return new e(et.min(),eo.empty(),-1)}},{key:"max",value:function(){return new e(et.max(),eo.empty(),-1)}}]),e}(),ec=function(){function e(){(0,p.Z)(this,e),this.onCommittedListeners=[]}return(0,m.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach(function(e){return e()})}}]),e}();function el(e){return eh.apply(this,arguments)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eh(){return(eh=(0,h.Z)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.code!==U.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)){e.next=2;break}throw t;case 2:M("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}var ef=function(){function e(t){var n=this;(0,p.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)},function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)})}return(0,m.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&P(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}})}},{key:"toPromise",value:function(){var e=this;return new Promise(function(t,n){e.next(t,n)})}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)}}],[{key:"resolve",value:function(t){return new e(function(e,n){e(t)})}},{key:"reject",value:function(t){return new e(function(e,n){n(t)})}},{key:"waitFor",value:function(t){return new e(function(e,n){var r=0,i=0,a=!1;t.forEach(function(t){++r,t.next(function(){++i,a&&i===r&&e()},function(e){return n(e)})}),a=!0,i===r&&e()})}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=A(t);try{for(i.s();!(n=i.n()).done;)!function(){var t=n.value;r=r.next(function(n){return n?e.resolve(n):t()})}()}catch(e){i.e(e)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach(function(e,i){r.push(t.call(n,e,i))}),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e(function(e,r){for(var i=t.length,a=Array(i),o=0,u=0;u<i;u++)!function(){var s=u;n(t[s]).next(function(t){a[s]=t,++o===i&&e(a)},function(e){return r(e)})}()})}},{key:"doWhile",value:function(t,n){return new e(function(e,r){!function i(){!0===t()?n().next(function(){i()},r):e()}()})}}]),e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ed(e){return"IndexedDbTransactionError"===e.name}var ev=function(){function e(t,n){var r=this;(0,p.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.ie(e)},this.se=function(e){return n.writeSequenceNumber(e)})}return(0,m.Z)(e,[{key:"ie",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.se&&this.se(e),e}}]),e}();function ey(e){return 0===e&&1/e==-1/0}ev.oe=-1;var ep=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function em(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function eg(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ek(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */[].concat((0,y.Z)(ep),["documentOverlays"]),[].concat(["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],["indexConfiguration","indexState","indexEntries"]);var ew=function(){function e(t,n){(0,p.Z)(this,e),this.comparator=t,this.root=n||eE.EMPTY}return(0,m.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,eE.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,eE.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal(function(t,n){return e(t,n),!1})}},{key:"toString",value:function(){var e=[];return this.inorderTraversal(function(t,n){return e.push("".concat(t,":").concat(n)),!1}),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new e_(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new e_(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new e_(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new e_(this.root,e,this.comparator,!0)}}]),e}(),e_=function(){function e(t,n,r,i){(0,p.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,m.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),eE=function(){function e(t,n,r,i,a){(0,p.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,m.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(0>n(t,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){return Math.pow(2,this.check())<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw P();var e=this.left.check();if(e!==this.right.check())throw P();return e+(this.isRed()?0:1)}}]),e}();eE.EMPTY=null,eE.RED=!0,eE.BLACK=!1,eE.EMPTY=new(function(){function e(){(0,p.Z)(this,e),this.size=0}return(0,m.Z)(e,[{key:"key",get:function(){throw P()}},{key:"value",get:function(){throw P()}},{key:"color",get:function(){throw P()}},{key:"left",get:function(){throw P()}},{key:"right",get:function(){throw P()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new eE(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var eT=function(){function e(t){(0,p.Z)(this,e),this.comparator=t,this.data=new ew(this.comparator)}return(0,m.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal(function(t,n){return e(t),!1})}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new eI(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new eI(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t}},{key:"isEqual",value:function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}},{key:"toString",value:function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),eI=function(){function e(t){(0,p.Z)(this,e),this.iter=t}return(0,m.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}(),eb=function(){function e(t){(0,p.Z)(this,e),this.fields=t,t.sort(ea.comparator)}return(0,m.Z)(e,[{key:"unionWith",value:function(t){var n,r=new eT(ea.comparator),i=A(this.fields);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r.add(a)}}catch(e){i.e(e)}finally{i.f()}var o,u=A(t);try{for(u.s();!(o=u.n()).done;){var s=o.value;r=r.add(s)}}catch(e){u.e(e)}finally{u.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=A(this.fields);try{for(n.s();!(t=n.n()).done;)if(t.value.isPrefixOf(e))return!0}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return $(this.fields,e.fields,function(e,t){return e.isEqual(t)})}}],[{key:"empty",value:function(){return new e([])}}]),e}(),ex=function(e){(0,f.Z)(n,e);var t=S(n);function n(){var e;return(0,p.Z)(this,n),e=t.apply(this,arguments),e.name="Base64DecodeError",e}return(0,m.Z)(n)}((0,l.Z)(Error)),eA=function(e){function t(e){(0,p.Z)(this,t),this.binaryString=e}return(0,m.Z)(t,[{key:e,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return btoa(this.binaryString)}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return J(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ex("Invalid base64 string: "+e):e}}(e))}},{key:"fromUint8Array",value:function(e){return new t(function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}}]),t}(Symbol.iterator);eA.EMPTY_BYTE_STRING=new eA("");var eC=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function eS(e){if(e||P(),"string"==typeof e){var t=0,n=eC.exec(e);if(n||P(),n[1]){var r=n[1];t=Number(r=(r+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:eN(e.seconds),nanos:eN(e.nanos)}}function eN(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function eD(e){return"string"==typeof e?eA.fromBase64String(e):eA.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eZ(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function eR(e){var t=e.mapValue.fields.__previous_value__;return eZ(t)?eR(t):t}function eL(e){var t=eS(e.mapValue.fields.__local_write_time__.timestampValue);return new ee(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eM=(0,m.Z)(function e(t,n,r,i,a,o,u,s,c){(0,p.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=s,this.useFetchStreams=c}),eV=function(){function e(t,n){(0,p.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,m.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}(),eF={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function eO(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?eZ(e)?4:eX(e)?9007199254740991:10:P()}function eP(e,t){if(e===t)return!0;var n=eO(e);if(n!==eO(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return eL(e).isEqual(eL(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=eS(e.timestampValue),r=eS(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return eD(e.bytesValue).isEqual(eD(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return eN(e.geoPointValue.latitude)===eN(t.geoPointValue.latitude)&&eN(e.geoPointValue.longitude)===eN(t.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return eN(e.integerValue)===eN(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=eN(e.doubleValue),r=eN(t.doubleValue);return n===r?ey(n)===ey(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return $(e.arrayValue.values||[],t.arrayValue.values||[],eP);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(em(n)!==em(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!eP(n[i],r[i])))return!1;return!0}(e,t);default:return P()}}function eU(e,t){return void 0!==(e.values||[]).find(function(e){return eP(e,t)})}function eq(e,t){if(e===t)return 0;var n,r,i,a,o,u,s,c,l,h=eO(e),f=eO(t);if(h!==f)return J(h,f);switch(h){case 0:case 9007199254740991:return 0;case 1:return J(e.booleanValue,t.booleanValue);case 2:return(n=eN(e.integerValue||e.doubleValue))<(r=eN(t.integerValue||t.doubleValue))?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1;case 3:return eB(e.timestampValue,t.timestampValue);case 4:return eB(eL(e),eL(t));case 5:return J(e.stringValue,t.stringValue);case 6:return i=e.bytesValue,a=t.bytesValue,o=eD(i),u=eD(a),o.compareTo(u);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=J(n[i],r[i]);if(0!==a)return a}return J(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return s=e.geoPointValue,c=t.geoPointValue,0!==(l=J(eN(s.latitude),eN(c.latitude)))?l:J(eN(s.longitude),eN(c.longitude));case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=eq(n[i],r[i]);if(a)return a}return J(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===eF.mapValue&&t===eF.mapValue)return 0;if(e===eF.mapValue)return 1;if(t===eF.mapValue)return -1;var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var o=0;o<r.length&&o<a.length;++o){var u=J(r[o],a[o]);if(0!==u)return u;var s=eq(n[r[o]],i[a[o]]);if(0!==s)return s}return J(r.length,a.length)}(e.mapValue,t.mapValue);default:throw P()}}function eB(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return J(e,t);var n=eS(e),r=eS(t),i=J(n.seconds,r.seconds);return 0!==i?i:J(n.nanos,r.nanos)}function ez(e){var t,n,r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(t=eS(e.timestampValue),"time(".concat(t.seconds,",").concat(t.nanos,")")):"stringValue"in e?e.stringValue:"bytesValue"in e?eD(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,eo.fromName(n).toString()):"geoPointValue"in e?(r=e.geoPointValue,"geo(".concat(r.latitude,",").concat(r.longitude,")")):"arrayValue"in e?function(e){var t,n="[",r=!0,i=A(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=ez(a)}}catch(e){i.e(e)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n=Object.keys(e.fields||{}).sort(),r="{",i=!0,a=A(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;i?i=!1:r+=",",r+="".concat(o,":").concat(ez(e.fields[o]))}}catch(e){a.e(e)}finally{a.f()}return r+"}"}(e.mapValue):P()}function eG(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function eK(e){return!!e&&"integerValue"in e}function eQ(e){return!!e&&"arrayValue"in e}function ej(e){return!!e&&"nullValue"in e}function eW(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function eH(e){return!!e&&"mapValue"in e}function eY(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return eg(e.mapValue.fields,function(e,n){return t.mapValue.fields[e]=eY(n)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=eY(e.arrayValue.values[r]);return n}return Object.assign({},e)}function eX(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}var eJ=function(){function e(t){(0,p.Z)(this,e),this.value=t}return(0,m.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!eH(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=eY(t)}},{key:"setAll",value:function(e){var t=this,n=ea.emptyPath(),r={},i=[];e.forEach(function(e,a){if(!n.isImmediateParentOf(a)){var o=t.getFieldsMap(n);t.applyChanges(o,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=eY(e):i.push(a.lastSegment())});var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());eH(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return eP(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];eH(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){eg(t,function(t,n){return e[t]=n});var r,i=A(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(e){i.e(e)}finally{i.f()}}},{key:"clone",value:function(){return new e(eY(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}(),e$=function(){function e(t,n,r,i,a,o,u){(0,p.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.createTime=a,this.data=o,this.documentState=u}return(0,m.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return this.createTime.isEqual(et.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=eJ.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=eJ.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=et.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,et.min(),et.min(),et.min(),eJ.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r,i){return new e(t,1,n,et.min(),r,i,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,et.min(),et.min(),eJ.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,et.min(),et.min(),eJ.empty(),2)}}]),e}(),e0=(0,m.Z)(function e(t,n){(0,p.Z)(this,e),this.position=t,this.inclusive=n});function e1(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],o=e.position[i];if(r=a.field.isKeyField()?eo.comparator(eo.fromName(o.referenceValue),n.key):eq(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function e2(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!eP(e.position[n],t.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var e3=(0,m.Z)(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,p.Z)(this,e),this.field=t,this.dir=n}),e4=(0,m.Z)(function e(){(0,p.Z)(this,e)}),e5=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i){var a;return(0,p.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(eq(t,this.value)):null!==t&&eO(this.value)===eO(t)&&this.matchesComparison(eq(t,this.value))}},{key:"matchesComparison",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return P()}}},{key:"isInequality",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}},{key:"getFlattenedFilters",value:function(){return[this]}},{key:"getFilters",value:function(){return[this]}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new tn(e,t,r):"array-contains"===t?new to(e,r):"in"===t?new tu(e,r):"not-in"===t?new ts(e,r):"array-contains-any"===t?new tc(e,r):new n(e,t,r)}},{key:"createKeyFieldInFilter",value:function(e,t,n){return"in"===t?new tr(e,n):new ti(e,n)}}]),n}(e4),e9=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){var i;return(0,p.Z)(this,n),(i=t.call(this)).filters=e,i.op=r,i.ae=null,i}return(0,m.Z)(n,[{key:"matches",value:function(e){return e6(this)?void 0===this.filters.find(function(t){return!t.matches(e)}):void 0!==this.filters.find(function(t){return t.matches(e)})}},{key:"getFlattenedFilters",value:function(){return null!==this.ae||(this.ae=this.filters.reduce(function(e,t){return e.concat(t.getFlattenedFilters())},[])),this.ae}},{key:"getFilters",value:function(){return Object.assign([],this.filters)}}],[{key:"create",value:function(e,t){return new n(e,t)}}]),n}(e4);function e6(e){return"and"===e.op}function e8(e){return"or"===e.op}function e7(e){return te(e)&&e6(e)}function te(e){var t,n=A(e.filters);try{for(n.s();!(t=n.n()).done;)if(t.value instanceof e9)return!1}catch(e){n.e(e)}finally{n.f()}return!0}function tt(e,t){var n=e.filters.concat(t);return e9.create(n,e.op)}var tn=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i){var a;return(0,p.Z)(this,n),(a=t.call(this,e,r,i)).key=eo.fromName(i.referenceValue),a}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=eo.comparator(e.key,this.key);return this.matchesComparison(t)}}]),n}(e5),tr=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){var i;return(0,p.Z)(this,n),(i=t.call(this,e,"in",r)).keys=ta("in",r),i}return(0,m.Z)(n,[{key:"matches",value:function(e){return this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}(e5),ti=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){var i;return(0,p.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=ta("not-in",r),i}return(0,m.Z)(n,[{key:"matches",value:function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}(e5);function ta(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(e){return eo.fromName(e.referenceValue)})}var to=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){return(0,p.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return eQ(t)&&eU(t.arrayValue,this.value)}}]),n}(e5),tu=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){return(0,p.Z)(this,n),t.call(this,e,"in",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&eU(this.value.arrayValue,t)}}]),n}(e5),ts=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){return(0,p.Z)(this,n),t.call(this,e,"not-in",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){if(eU(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!eU(this.value.arrayValue,t)}}]),n}(e5),tc=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){return(0,p.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!eQ(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(e){return eU(t.value.arrayValue,e)})}}]),n}(e5),tl=(0,m.Z)(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,p.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=u,this.ue=null});function th(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new tl(e,t,n,r,i,a,o)}function tf(e){if(null===e.ue){var t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:"+e.filters.map(function(e){return function e(t){if(t instanceof e5)return t.field.canonicalString()+t.op.toString()+ez(t.value);if(e7(t))return t.filters.map(function(t){return e(t)}).join(",");var n=t.filters.map(function(t){return e(t)}).join(",");return"".concat(t.op,"(").concat(n,")")}(e)}).join(",")+"|ob:"+e.orderBy.map(function(e){return e.field.canonicalString()+e.dir}).join(","),null==e.limit||(t+="|l:"+e.limit),e.startAt&&(t+="|lb:"+(e.startAt.inclusive?"b:":"a:")+e.startAt.position.map(function(e){return ez(e)}).join(",")),e.endAt&&(t+="|ub:"+(e.endAt.inclusive?"a:":"b:")+e.endAt.position.map(function(e){return ez(e)}).join(",")),e.ue=t}return e.ue}function td(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var n,r,i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1;if(e.filters.length!==t.filters.length)return!1;for(var a=0;a<e.filters.length;a++)if(!function e(t,n){return t instanceof e5?n instanceof e5&&t.op===n.op&&t.field.isEqual(n.field)&&eP(t.value,n.value):t instanceof e9?n instanceof e9&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce(function(t,r,i){return t&&e(r,n.filters[i])},!0):void P()}(e.filters[a],t.filters[a]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!e2(e.startAt,t.startAt)&&e2(e.endAt,t.endAt)}function tv(e){return eo.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var ty=(0,m.Z)(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,p.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=u,this.endAt=s,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt});function tp(e){return new ty(e)}function tm(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function tg(e){return null!==e.collectionGroup}function tk(e){if(null===e.ce){e.ce=[];var t,n,r=new Set,i=A(e.explicitOrderBy);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.ce.push(a),r.add(a.field.canonicalString())}}catch(e){i.e(e)}finally{i.f()}var o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new eT(ea.comparator),e.filters.forEach(function(e){e.getFlattenedFilters().forEach(function(e){e.isInequality()&&(t=t.add(e.field))})}),t).forEach(function(t){r.has(t.canonicalString())||t.isKeyField()||e.ce.push(new e3(t,o))}),r.has(ea.keyField().canonicalString())||e.ce.push(new e3(ea.keyField(),o))}return e.ce}function tw(e){return e.le||(e.le=function(e,t){if("F"===e.limitType)return th(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);t=t.map(function(e){var t="desc"===e.dir?"asc":"desc";return new e3(e.field,t)});var n=e.endAt?new e0(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new e0(e.startAt.position,e.startAt.inclusive):null;return th(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}(e,tk(e))),e.le}function t_(e,t){var n=e.filters.concat([t]);return new ty(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function tE(e,t,n){return new ty(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function tT(e,t){return td(tw(e),tw(t))&&e.limitType===t.limitType}function tI(e){return"".concat(tf(tw(e)),"|lt:").concat(e.limitType)}function tb(e){var t,n;return"Query(target=".concat((n=(t=tw(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=", filters: [".concat(t.filters.map(function(e){return function e(t){return t instanceof e5?"".concat(t.field.canonicalString()," ").concat(t.op," ").concat(ez(t.value)):t instanceof e9?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"}(e)}).join(", "),"]")),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=", orderBy: [".concat(t.orderBy.map(function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}).join(", "),"]")),t.startAt&&(n+=", startAt: "+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(function(e){return ez(e)}).join(",")),t.endAt&&(n+=", endAt: "+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(function(e){return ez(e)}).join(",")),"Target(".concat(n,")")),"; limitType=").concat(e.limitType,")")}function tx(e,t){var n,r,i,a,o;return t.isFoundDocument()&&(n=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):eo.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(e,t){var n,r=A(tk(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(e){r.e(e)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=A(e.filters);try{for(r.s();!(n=r.n()).done;)if(!n.value.matches(t))return!1}catch(e){r.e(e)}finally{r.f()}return!0}(e,t)&&(!e.startAt||(i=e1(r=e.startAt,tk(e),t),r.inclusive?i<=0:i<0))&&(!e.endAt||(o=e1(a=e.endAt,tk(e),t),a.inclusive?o>=0:o>0))}function tA(e){return function(t,n){var r,i=!1,a=A(tk(e));try{for(a.s();!(r=a.n()).done;){var o=r.value,u=function(e,t,n){var r,i,a,o=e.field.isKeyField()?eo.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),a=n.data.field(r),null!==i&&null!==a?eq(i,a):P());switch(e.dir){case"asc":return o;case"desc":return -1*o;default:return P()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(o,t,n);if(0!==u)return u;i=i||o.field.isKeyField()}}catch(e){a.e(e)}finally{a.f()}return 0}}var tC=function(){function e(t,n){(0,p.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return(0,m.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=A(n);try{for(i.s();!(r=i.n()).done;){var a=(0,c.Z)(r.value,2),o=a[0],u=a[1];if(this.equalsFn(o,e))return u}}catch(e){i.e(e)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){eg(this.inner,function(t,n){var r,i=A(n);try{for(i.s();!(r=i.n()).done;){var a=(0,c.Z)(r.value,2),o=a[0],u=a[1];e(o,u)}}catch(e){i.e(e)}finally{i.f()}})}},{key:"isEmpty",value:function(){return ek(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),tS=new ew(eo.comparator),tN=new ew(eo.comparator);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tD(){for(var e=tN,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;i++){var a=n[i];e=e.insert(a.key,a)}return e}function tZ(e){var t=tN;return e.forEach(function(e,n){return t=t.insert(e,n.overlayedDocument)}),t}function tR(){return new tC(function(e){return e.toString()},function(e,t){return e.isEqual(t)})}var tL=new ew(eo.comparator),tM=new eT(eo.comparator);function tV(){for(var e=tM,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;i++){var a=n[i];e=e.add(a)}return e}var tF=new eT(J);function tO(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ey(t)?"-0":t}}function tP(e){return{integerValue:""+e}}var tU=(0,m.Z)(function e(){(0,p.Z)(this,e),this._=void 0});function tq(e,t){return e instanceof tj?eK(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}var tB=function(e){(0,f.Z)(n,e);var t=S(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n)}(tU),tz=function(e){(0,f.Z)(n,e);var t=S(n);function n(e){var r;return(0,p.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,m.Z)(n)}(tU);function tG(e,t){var n,r=tH(t),i=A(e.elements);try{for(i.s();!(n=i.n()).done;)!function(){var e=n.value;r.some(function(t){return eP(t,e)})||r.push(e)}()}catch(e){i.e(e)}finally{i.f()}return{arrayValue:{values:r}}}var tK=function(e){(0,f.Z)(n,e);var t=S(n);function n(e){var r;return(0,p.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,m.Z)(n)}(tU);function tQ(e,t){var n,r=tH(t),i=A(e.elements);try{for(i.s();!(n=i.n()).done;)!function(){var e=n.value;r=r.filter(function(t){return!eP(t,e)})}()}catch(e){i.e(e)}finally{i.f()}return{arrayValue:{values:r}}}var tj=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){var i;return(0,p.Z)(this,n),(i=t.call(this)).serializer=e,i.Pe=r,i}return(0,m.Z)(n)}(tU);function tW(e){return eN(e.integerValue||e.doubleValue)}function tH(e){return eQ(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tY=(0,m.Z)(function e(t,n){(0,p.Z)(this,e),this.version=t,this.transformResults=n}),tX=function(){function e(t,n){(0,p.Z)(this,e),this.updateTime=t,this.exists=n}return(0,m.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function tJ(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var t$=(0,m.Z)(function e(){(0,p.Z)(this,e)});function t0(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new t8(e.key,tX.none()):new t3(e.key,e.data,tX.none());var n,r=e.data,i=eJ.empty(),a=new eT(ea.comparator),o=A(t.fields);try{for(o.s();!(n=o.n()).done;){var u=n.value;if(!a.has(u)){var s=r.field(u);null===s&&u.length>1&&(u=u.popLast(),s=r.field(u)),null===s?i.delete(u):i.set(u,s),a=a.add(u)}}}catch(e){o.e(e)}finally{o.f()}return new t4(e.key,i,new eb(a.toArray()),tX.none())}function t1(e,t,n,r){return e instanceof t3?function(e,t,n,r){if(!tJ(e.precondition,t))return n;var i=e.value.clone(),a=t6(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof t4?function(e,t,n,r){if(!tJ(e.precondition,t))return n;var i=t6(e.fieldTransforms,r,t),a=t.data;return(a.setAll(t5(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(function(e){return e.field}))}(e,t,n,r):tJ(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function t2(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&$(n,r,function(e,t){var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof tz&&r instanceof tz||n instanceof tK&&r instanceof tK?$(n.elements,r.elements,eP):n instanceof tj&&r instanceof tj?eP(n.Pe,r.Pe):n instanceof tB&&r instanceof tB)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var t3=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,p.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=o,a.type=0,a}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(t$),t4=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i,a){var o,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,p.Z)(this,n),(o=t.call(this)).key=e,o.data=r,o.fieldMask=i,o.precondition=a,o.fieldTransforms=u,o.type=1,o}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}(t$);function t5(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function t9(e,t,n){var r=new Map;e.length===n.length||P();for(var i=0;i<n.length;i++){var a,o=e[i],u=o.transform,s=t.data.field(o.field);r.set(o.field,(a=n[i],u instanceof tz?tG(u,s):u instanceof tK?tQ(u,s):a))}return r}function t6(e,t,n){var r,i=new Map,a=A(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,u=o.transform,s=n.data.field(o.field);i.set(o.field,function(e,t,n){var r,i,a,o;return e instanceof tB?(r=t,i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&eZ(r)&&(r=eR(r)),r&&(i.fields.__previous_value__=r),{mapValue:i}):e instanceof tz?tG(e,t):e instanceof tK?tQ(e,t):(o=tW(a=tq(e,t))+tW(e.Pe),eK(a)&&eK(e.Pe)?tP(o):tO(e.serializer,o))}(u,s,t))}}catch(e){a.e(e)}finally{a.f()}return i}var t8=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){var i;return(0,p.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(t$),t7=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){var i;return(0,p.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(t$),ne=function(){function e(t,n,r,i){(0,p.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,m.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&function(e,t,n){var r,i;e instanceof t3?(r=e.value.clone(),i=t9(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof t4?function(e,t,n){if(!tJ(e.precondition,t))return void t.convertToUnknownDocument(n.version);var r=t9(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(t5(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}(i,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=A(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(e.key)&&(t=t1(i,e,t,this.localWriteTime))}}catch(e){r.e(e)}finally{r.f()}var a,o=A(this.mutations);try{for(o.s();!(a=o.n()).done;){var u=a.value;u.key.isEqual(e.key)&&(t=t1(u,e,t,this.localWriteTime))}}catch(e){o.e(e)}finally{o.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=tR();return this.mutations.forEach(function(i){var a=e.get(i.key),o=a.overlayedDocument,u=n.applyToLocalView(o,a.mutatedFields),s=t0(o,u=t.has(i.key)?null:u);null!==s&&r.set(i.key,s),o.isValidDocument()||o.convertToNoDocument(et.min())}),r}},{key:"keys",value:function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},tV())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&$(this.mutations,e.mutations,function(e,t){return t2(e,t)})&&$(this.baseMutations,e.baseMutations,function(e,t){return t2(e,t)})}}]),e}(),nt=function(){function e(t,n,r,i){(0,p.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,m.Z)(e,null,[{key:"from",value:function(t,n,r){t.mutations.length===r.length||P();for(var i=tL,a=t.mutations,o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new e(t,n,r,i)}}]),e}(),nn=function(){function e(t,n){(0,p.Z)(this,e),this.largestBatchId=t,this.mutation=n}return(0,m.Z)(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),nr=(0,m.Z)(function e(t,n){(0,p.Z)(this,e),this.count=t,this.unchangedNames=n});function ni(e){if(void 0===e)return V("GRPC error has no .code"),U.UNKNOWN;switch(e){case r.OK:return U.OK;case r.CANCELLED:return U.CANCELLED;case r.UNKNOWN:return U.UNKNOWN;case r.DEADLINE_EXCEEDED:return U.DEADLINE_EXCEEDED;case r.RESOURCE_EXHAUSTED:return U.RESOURCE_EXHAUSTED;case r.INTERNAL:return U.INTERNAL;case r.UNAVAILABLE:return U.UNAVAILABLE;case r.UNAUTHENTICATED:return U.UNAUTHENTICATED;case r.INVALID_ARGUMENT:return U.INVALID_ARGUMENT;case r.NOT_FOUND:return U.NOT_FOUND;case r.ALREADY_EXISTS:return U.ALREADY_EXISTS;case r.PERMISSION_DENIED:return U.PERMISSION_DENIED;case r.FAILED_PRECONDITION:return U.FAILED_PRECONDITION;case r.ABORTED:return U.ABORTED;case r.OUT_OF_RANGE:return U.OUT_OF_RANGE;case r.UNIMPLEMENTED:return U.UNIMPLEMENTED;case r.DATA_LOSS:return U.DATA_LOSS;default:return P()}}(i=r||(r={}))[i.OK=0]="OK",i[i.CANCELLED=1]="CANCELLED",i[i.UNKNOWN=2]="UNKNOWN",i[i.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",i[i.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",i[i.NOT_FOUND=5]="NOT_FOUND",i[i.ALREADY_EXISTS=6]="ALREADY_EXISTS",i[i.PERMISSION_DENIED=7]="PERMISSION_DENIED",i[i.UNAUTHENTICATED=16]="UNAUTHENTICATED",i[i.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",i[i.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",i[i.ABORTED=10]="ABORTED",i[i.OUT_OF_RANGE=11]="OUT_OF_RANGE",i[i.UNIMPLEMENTED=12]="UNIMPLEMENTED",i[i.INTERNAL=13]="INTERNAL",i[i.UNAVAILABLE=14]="UNAVAILABLE",i[i.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var na=new I.z8([4294967295,4294967295],0);function no(e){var t=new TextEncoder().encode(e),n=new I.V8;return n.update(t),new Uint8Array(n.digest())}function nu(e){var t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new I.z8([n,r],0),new I.z8([i,a],0)]}var ns=function(){function e(t,n,r){if((0,p.Z)(this,e),this.bitmap=t,this.padding=n,this.hashCount=r,n<0||n>=8)throw new nc("Invalid padding: ".concat(n));if(r<0||t.length>0&&0===this.hashCount)throw new nc("Invalid hash count: ".concat(r));if(0===t.length&&0!==n)throw new nc("Invalid padding when bitmap length is 0: ".concat(n));this.Ie=8*t.length-n,this.Te=I.z8.fromNumber(this.Ie)}return(0,m.Z)(e,[{key:"Ee",value:function(e,t,n){var r=e.add(t.multiply(I.z8.fromNumber(n)));return 1===r.compare(na)&&(r=new I.z8([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}},{key:"de",value:function(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}},{key:"mightContain",value:function(e){if(0===this.Ie)return!1;for(var t=nu(no(e)),n=(0,c.Z)(t,2),r=n[0],i=n[1],a=0;a<this.hashCount;a++){var o=this.Ee(r,i,a);if(!this.de(o))return!1}return!0}},{key:"insert",value:function(e){if(0!==this.Ie)for(var t=nu(no(e)),n=(0,c.Z)(t,2),r=n[0],i=n[1],a=0;a<this.hashCount;a++){var o=this.Ee(r,i,a);this.Ae(o)}}},{key:"Ae",value:function(e){this.bitmap[Math.floor(e/8)]|=1<<e%8}}],[{key:"create",value:function(t,n,r){var i=new e(new Uint8Array(Math.ceil(t/8)),t%8==0?0:8-t%8,n);return r.forEach(function(e){return i.insert(e)}),i}}]),e}(),nc=function(e){(0,f.Z)(n,e);var t=S(n);function n(){var e;return(0,p.Z)(this,n),e=t.apply(this,arguments),e.name="BloomFilterError",e}return(0,m.Z)(n)}((0,l.Z)(Error)),nl=function(){function e(t,n,r,i,a){(0,p.Z)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return(0,m.Z)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n,r){var i=new Map;return i.set(t,nh.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new e(et.min(),i,new ew(J),tS,tV())}}]),e}(),nh=function(){function e(t,n,r,i,a){(0,p.Z)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return(0,m.Z)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n,r){return new e(r,n,tV(),tV(),tV())}}]),e}(),nf=(0,m.Z)(function e(t,n,r,i){(0,p.Z)(this,e),this.Re=t,this.removedTargetIds=n,this.key=r,this.Ve=i}),nd=(0,m.Z)(function e(t,n){(0,p.Z)(this,e),this.targetId=t,this.me=n}),nv=(0,m.Z)(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eA.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,p.Z)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i}),ny=function(){function e(){(0,p.Z)(this,e),this.fe=0,this.ge=ng(),this.pe=eA.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}return(0,m.Z)(e,[{key:"current",get:function(){return this.ye}},{key:"resumeToken",get:function(){return this.pe}},{key:"Se",get:function(){return 0!==this.fe}},{key:"be",get:function(){return this.we}},{key:"De",value:function(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}},{key:"Ce",value:function(){var e=tV(),t=tV(),n=tV();return this.ge.forEach(function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:P()}}),new nh(this.pe,this.ye,e,t,n)}},{key:"ve",value:function(){this.we=!1,this.ge=ng()}},{key:"Fe",value:function(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}},{key:"Me",value:function(e){this.we=!0,this.ge=this.ge.remove(e)}},{key:"xe",value:function(){this.fe+=1}},{key:"Oe",value:function(){this.fe-=1,this.fe>=0||P()}},{key:"Ne",value:function(){this.we=!0,this.ye=!0}}]),e}(),np=function(){function e(t){(0,p.Z)(this,e),this.Le=t,this.Be=new Map,this.ke=tS,this.qe=nm(),this.Qe=new ew(J)}return(0,m.Z)(e,[{key:"Ke",value:function(e){var t,n=A(e.Re);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve)}}catch(e){n.e(e)}finally{n.f()}var i,a=A(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.Ue(o,e.key,e.Ve)}}catch(e){a.e(e)}finally{a.f()}}},{key:"We",value:function(e){var t=this;this.forEachTarget(e,function(n){var r=t.Ge(n);switch(e.state){case 0:t.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||t.removeTarget(n);break;case 3:t.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:t.ze(n)&&(t.je(n),r.De(e.resumeToken));break;default:P()}})}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(function(e,r){n.ze(r)&&t(r)})}},{key:"He",value:function(e){var t=e.targetId,n=e.me.count,r=this.Je(t);if(r){var i=r.target;if(tv(i)){if(0===n){var a=new eo(i.path);this.Ue(t,a,e$.newNoDocument(a,et.min()))}else 1===n||P()}else{var o=this.Ye(t);if(o!==n){var u=this.Ze(e),s=u?this.Xe(u,e,o):1;0!==s&&(this.je(t),this.Qe=this.Qe.insert(t,2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}},{key:"Ze",value:function(e){var t,n,r=e.me.unchangedNames;if(!r||!r.bits)return null;var i=r.bits,a=i.bitmap,o=i.padding,u=r.hashCount;try{t=eD(void 0===a?"":a).toUint8Array()}catch(e){if(e instanceof ex)return F("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new ns(t,void 0===o?0:o,void 0===u?0:u)}catch(e){return F(e instanceof nc?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.Ie?null:n}},{key:"Xe",value:function(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}},{key:"nt",value:function(e,t){var n=this,r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(function(r){var a=n.Le.tt(),o="projects/".concat(a.projectId,"/databases/").concat(a.database,"/documents/").concat(r.path.canonicalString());e.mightContain(o)||(n.Ue(t,r,null),i++)}),i}},{key:"rt",value:function(e){var t=this,n=new Map;this.Be.forEach(function(r,i){var a=t.Je(i);if(a){if(r.current&&tv(a.target)){var o=new eo(a.target.path);null!==t.ke.get(o)||t.it(i,o)||t.Ue(i,o,e$.newNoDocument(o,e))}r.be&&(n.set(i,r.Ce()),r.ve())}});var r=tV();this.qe.forEach(function(e,n){var i=!0;n.forEachWhile(function(e){var n=t.Je(e);return!n||"TargetPurposeLimboResolution"===n.purpose||(i=!1,!1)}),i&&(r=r.add(e))}),this.ke.forEach(function(t,n){return n.setReadTime(e)});var i=new nl(e,n,this.Qe,this.ke,r);return this.ke=tS,this.qe=nm(),this.Qe=new ew(J),i}},{key:"$e",value:function(e,t){if(this.ze(e)){var n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}}},{key:"Ue",value:function(e,t,n){if(this.ze(e)){var r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}}},{key:"removeTarget",value:function(e){this.Be.delete(e)}},{key:"Ye",value:function(e){var t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"xe",value:function(e){this.Ge(e).xe()}},{key:"Ge",value:function(e){var t=this.Be.get(e);return t||(t=new ny,this.Be.set(e,t)),t}},{key:"st",value:function(e){var t=this.qe.get(e);return t||(t=new eT(J),this.qe=this.qe.insert(e,t)),t}},{key:"ze",value:function(e){var t=null!==this.Je(e);return t||M("WatchChangeAggregator","Detected inactive target",e),t}},{key:"Je",value:function(e){var t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}},{key:"je",value:function(e){var t=this;this.Be.set(e,new ny),this.Le.getRemoteKeysForTarget(e).forEach(function(n){t.Ue(e,n,null)})}},{key:"it",value:function(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}]),e}();function nm(){return new ew(eo.comparator)}function ng(){return new ew(eo.comparator)}var nk={asc:"ASCENDING",desc:"DESCENDING"},nw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},n_={and:"AND",or:"OR"},nE=(0,m.Z)(function e(t,n){(0,p.Z)(this,e),this.databaseId=t,this.useProto3Json=n});function nT(e,t){return e.useProto3Json||null==t?t:{value:t}}function nI(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function nb(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function nx(e){var t;return e||P(),et.fromTimestamp(new ee((t=eS(e)).seconds,t.nanos))}function nA(e,t){return nC(e,t).canonicalString()}function nC(e,t){var n=new er(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function nS(e){var t=er.fromString(e);return nO(t)||P(),t}function nN(e,t){return nA(e.databaseId,t.path)}function nD(e,t){var n=nS(t);if(n.get(1)!==e.databaseId.projectId)throw new q(U.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new q(U.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new eo(nL(n))}function nZ(e,t){return nA(e.databaseId,t)}function nR(e){return new er(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function nL(e){return e.length>4&&"documents"===e.get(4)||P(),e.popFirst(5)}function nM(e,t,n){return{name:nN(e,t),fields:n.value.mapValue.fields}}function nV(e){return{fieldPath:e.canonicalString()}}function nF(e){return ea.fromServerFormat(e.fieldPath)}function nO(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nP=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:et.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:et.min(),u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:eA.EMPTY_BYTE_STRING,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,p.Z)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=s}return(0,m.Z)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}},{key:"withExpectedCount",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}]),e}(),nU=(0,m.Z)(function e(t){(0,p.Z)(this,e),this.ct=t}),nq=function(){function e(){(0,p.Z)(this,e)}return(0,m.Z)(e,[{key:"Pt",value:function(e,t){this.It(e,t),t.Tt()}},{key:"It",value:function(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(eN(e.integerValue));else if("doubleValue"in e){var n=eN(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),ey(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){var r=e.timestampValue;this.Et(t,20),"string"==typeof r&&(r=eS(r)),t.At("".concat(r.seconds||"")),t.dt(r.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(eD(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.Et(t,45),t.dt(i.latitude||0),t.dt(i.longitude||0)}else"mapValue"in e?eX(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):P()}},{key:"Rt",value:function(e,t){this.Et(t,25),this.St(e,t)}},{key:"St",value:function(e,t){t.At(e)}},{key:"yt",value:function(e,t){var n=e.fields||{};this.Et(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.Rt(a,t),this.It(n[a],t)}}},{key:"wt",value:function(e,t){var n=e.values||[];this.Et(t,50);var r,i=A(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.It(a,t)}}catch(e){i.e(e)}finally{i.f()}}},{key:"gt",value:function(e,t){var n=this;this.Et(t,37),eo.fromName(e).path.forEach(function(e){n.Et(t,60),n.St(e,t)})}},{key:"Et",value:function(e,t){e.dt(t)}},{key:"Vt",value:function(e){e.dt(2)}}]),e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nq.bt=new nq;var nB=function(){function e(){(0,p.Z)(this,e),this._n=new nz}return(0,m.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this._n.add(t),ef.resolve()}},{key:"getCollectionParents",value:function(e,t){return ef.resolve(this._n.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return ef.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return ef.resolve()}},{key:"deleteAllFieldIndexes",value:function(e){return ef.resolve()}},{key:"createTargetIndexes",value:function(e,t){return ef.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return ef.resolve(null)}},{key:"getIndexType",value:function(e,t){return ef.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return ef.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return ef.resolve(null)}},{key:"getMinOffset",value:function(e,t){return ef.resolve(es.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return ef.resolve(es.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return ef.resolve()}},{key:"updateIndexEntries",value:function(e,t){return ef.resolve()}}]),e}(),nz=function(){function e(){(0,p.Z)(this,e),this.index={}}return(0,m.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new eT(er.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new eT(er.comparator)).toArray()}}]),e}();new Uint8Array(0);var nG=function(){function e(t,n,r){(0,p.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,m.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nG.DEFAULT_COLLECTION_PERCENTILE=10,nG.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nG.DEFAULT=new nG(41943040,nG.DEFAULT_COLLECTION_PERCENTILE,nG.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nG.DISABLED=new nG(-1,0,0);var nK=function(){function e(t){(0,p.Z)(this,e),this.On=t}return(0,m.Z)(e,[{key:"next",value:function(){return this.On+=2,this.On}}],[{key:"Nn",value:function(){return new e(0)}},{key:"Ln",value:function(){return new e(-1)}}]),e}(),nQ=function(){function e(){(0,p.Z)(this,e),this.changes=new tC(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}return(0,m.Z)(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,e$.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?ef.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),nj=(0,m.Z)(function e(t,n){(0,p.Z)(this,e),this.overlayedDocument=t,this.mutatedFields=n}),nW=function(){function e(t,n,r,i){(0,p.Z)(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return(0,m.Z)(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next(function(i){return r=i,n.remoteDocumentCache.getEntry(e,t)}).next(function(e){return null!==r&&t1(r.mutation,e,eb.empty(),ee.now()),e})}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t,tV()).next(function(){return t})})}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tV(),i=tR();return this.populateOverlays(e,i,t).next(function(){return n.computeViews(e,t,i,r).next(function(e){var t=tD();return e.forEach(function(e,n){t=t.insert(e,n.overlayedDocument)}),t})})}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=tR();return this.populateOverlays(e,r,t).next(function(){return n.computeViews(e,t,r,tV())})}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach(function(e){t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(function(e){e.forEach(function(e,n){t.set(e,n)})})}},{key:"computeViews",value:function(e,t,n,r){var i=tS,a=tR(),o=tR();return t.forEach(function(e,t){var o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof t4)?i=i.insert(t.key,t):void 0!==o?(a.set(t.key,o.mutation.getFieldMask()),t1(o.mutation,t,o.mutation.getFieldMask(),ee.now())):a.set(t.key,eb.empty())}),this.recalculateAndSaveOverlays(e,i).next(function(e){return e.forEach(function(e,t){return a.set(e,t)}),t.forEach(function(e,t){var n;return o.set(e,new nj(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o})}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=tR(),i=new ew(function(e,t){return e-t}),a=tV();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(function(e){var n,a=A(e);try{for(a.s();!(n=a.n()).done;)!function(){var e=n.value;e.keys().forEach(function(n){var a=t.get(n);if(null!==a){var o=r.get(n)||eb.empty();o=e.applyToLocalView(a,o),r.set(n,o);var u=(i.get(e.batchId)||tV()).add(n);i=i.insert(e.batchId,u)}})}()}catch(e){a.e(e)}finally{a.f()}}).next(function(){for(var o=[],u=i.getReverseIterator();u.hasNext();)!function(){var i=u.getNext(),s=i.key,c=i.value,l=tR();c.forEach(function(e){if(!a.has(e)){var n=t0(t.get(e),r.get(e));null!==n&&l.set(e,n),a=a.add(e)}}),o.push(n.documentOverlayCache.saveOverlays(e,s,l))}();return ef.waitFor(o)}).next(function(){return r})}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.recalculateAndSaveOverlays(e,t)})}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){return eo.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):tg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}},{key:"getNextDocuments",value:function(e,t,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(function(a){var o=r-a.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-a.size):ef.resolve(tR()),u=-1,s=a;return o.next(function(t){return ef.forEach(t,function(t,n){return u<n.largestBatchId&&(u=n.largestBatchId),a.get(t)?ef.resolve():i.remoteDocumentCache.getEntry(e,t).next(function(e){s=s.insert(t,e)})}).next(function(){return i.populateOverlays(e,t,a)}).next(function(){return i.computeViews(e,s,t,tV())}).next(function(e){return{batchId:u,changes:tZ(e)}})})})}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new eo(t)).next(function(e){var t=tD();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n,r){var i=this,a=t.collectionGroup,o=tD();return this.indexManager.getCollectionParents(e,a).next(function(u){return ef.forEach(u,function(u){var s=new ty(u.child(a),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return i.getDocumentsMatchingCollectionQuery(e,s,n,r).next(function(e){e.forEach(function(e,t){o=o.insert(e,t)})})}).next(function(){return o})})}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n,r){var i,a=this;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(function(o){return i=o,a.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)}).next(function(e){i.forEach(function(t,n){var r=n.getKey();null===e.get(r)&&(e=e.insert(r,e$.newInvalidDocument(r)))});var n=tD();return e.forEach(function(e,r){var a=i.get(e);void 0!==a&&t1(a.mutation,r,eb.empty(),ee.now()),tx(t,r)&&(n=n.insert(e,r))}),n})}}]),e}(),nH=function(){function e(t){(0,p.Z)(this,e),this.serializer=t,this.cr=new Map,this.lr=new Map}return(0,m.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return ef.resolve(this.cr.get(t))}},{key:"saveBundleMetadata",value:function(e,t){return this.cr.set(t.id,{id:t.id,version:t.version,createTime:nx(t.createTime)}),ef.resolve()}},{key:"getNamedQuery",value:function(e,t){return ef.resolve(this.lr.get(t))}},{key:"saveNamedQuery",value:function(e,t){var n,r;return this.lr.set(t.name,{name:t.name,query:(r=function(e){var t,n,r,i,a,o,u,s,c=4===(t=nS(e.parent)).length?er.emptyPath():nL(t),l=e.structuredQuery,h=l.from?l.from.length:0,f=null;if(h>0){1===h||P();var d=l.from[0];d.allDescendants?f=d.collectionId:c=c.child(d.collectionId)}var v=[];l.where&&(v=(n=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=nF(e.unaryFilter.field);return e5.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=nF(e.unaryFilter.field);return e5.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=nF(e.unaryFilter.field);return e5.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=nF(e.unaryFilter.field);return e5.create(i,"!=",{nullValue:"NULL_VALUE"});default:return P()}}(t):void 0!==t.fieldFilter?e5.create(nF(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return P()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?e9.create(t.compositeFilter.filters.map(function(t){return e(t)}),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return P()}}(t.compositeFilter.op)):P()}(l.where))instanceof e9&&e7(n)?n.getFilters():[n]);var y=[];l.orderBy&&(y=l.orderBy.map(function(e){return new e3(nF(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}));var p=null;l.limit&&(p=null==(i="object"==typeof(r=l.limit)?r.value:r)?null:i);var m=null;l.startAt&&(o=!!(a=l.startAt).before,m=new e0(a.values||[],o));var g=null;return l.endAt&&(s=!(u=l.endAt).before,g=new e0(u.values||[],s)),new ty(c,f,y,v,p,"F",m,g)}({parent:(n=t.bundledQuery).parent,structuredQuery:n.structuredQuery}),"LAST"===n.limitType?tE(r,r.limit,"L"):r),readTime:nx(t.readTime)}),ef.resolve()}}]),e}(),nY=function(){function e(){(0,p.Z)(this,e),this.overlays=new ew(eo.comparator),this.hr=new Map}return(0,m.Z)(e,[{key:"getOverlay",value:function(e,t){return ef.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=tR();return ef.forEach(t,function(t){return n.getOverlay(e,t).next(function(e){null!==e&&r.set(t,e)})}).next(function(){return r})}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach(function(n,i){r.ht(e,t,i)}),ef.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.hr.get(n);return void 0!==i&&(i.forEach(function(e){return r.overlays=r.overlays.remove(e)}),this.hr.delete(n)),ef.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=tR(),i=t.length+1,a=new eo(t.child("")),o=this.overlays.getIteratorFrom(a);o.hasNext();){var u=o.getNext().value,s=u.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&u.largestBatchId>n&&r.set(u.getKey(),u)}return ef.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new ew(function(e,t){return e-t}),a=this.overlays.getIterator();a.hasNext();){var o=a.getNext().value;if(o.getKey().getCollectionGroup()===t&&o.largestBatchId>n){var u=i.get(o.largestBatchId);null===u&&(u=tR(),i=i.insert(o.largestBatchId,u)),u.set(o.getKey(),o)}}for(var s=tR(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach(function(e,t){return s.set(e,t)}),!(s.size()>=r)););return ef.resolve(s)}},{key:"ht",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new nn(t,n));var a=this.hr.get(t);void 0===a&&(a=tV(),this.hr.set(t,a)),this.hr.set(t,a.add(n.key))}}]),e}(),nX=function(){function e(){(0,p.Z)(this,e),this.Pr=new eT(nJ.Ir),this.Tr=new eT(nJ.Er)}return(0,m.Z)(e,[{key:"isEmpty",value:function(){return this.Pr.isEmpty()}},{key:"addReference",value:function(e,t){var n=new nJ(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}},{key:"dr",value:function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})}},{key:"removeReference",value:function(e,t){this.Ar(new nJ(e,t))}},{key:"Rr",value:function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})}},{key:"Vr",value:function(e){var t=this,n=new eo(new er([])),r=new nJ(n,e),i=new nJ(n,e+1),a=[];return this.Tr.forEachInRange([r,i],function(e){t.Ar(e),a.push(e.key)}),a}},{key:"mr",value:function(){var e=this;this.Pr.forEach(function(t){return e.Ar(t)})}},{key:"Ar",value:function(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}},{key:"gr",value:function(e){var t=new eo(new er([])),n=new nJ(t,e),r=new nJ(t,e+1),i=tV();return this.Tr.forEachInRange([n,r],function(e){i=i.add(e.key)}),i}},{key:"containsKey",value:function(e){var t=new nJ(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),nJ=function(){function e(t,n){(0,p.Z)(this,e),this.key=t,this.pr=n}return(0,m.Z)(e,null,[{key:"Ir",value:function(e,t){return eo.comparator(e.key,t.key)||J(e.pr,t.pr)}},{key:"Er",value:function(e,t){return J(e.pr,t.pr)||eo.comparator(e.key,t.key)}}]),e}(),n$=function(){function e(t,n){(0,p.Z)(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.yr=1,this.wr=new eT(nJ.Ir)}return(0,m.Z)(e,[{key:"checkEmpty",value:function(e){return ef.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var a=new ne(i,t,n,r);this.mutationQueue.push(a);var o,u=A(r);try{for(u.s();!(o=u.n()).done;){var s=o.value;this.wr=this.wr.add(new nJ(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast())}}catch(e){u.e(e)}finally{u.f()}return ef.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return ef.resolve(this.Sr(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this.br(t+1),r=n<0?0:n;return ef.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return ef.resolve(0===this.mutationQueue.length?-1:this.yr-1)}},{key:"getAllMutationBatches",value:function(e){return ef.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new nJ(t,0),i=new nJ(t,Number.POSITIVE_INFINITY),a=[];return this.wr.forEachInRange([r,i],function(e){var t=n.Sr(e.pr);a.push(t)}),ef.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new eT(J);return t.forEach(function(e){var t=new nJ(e,0),i=new nJ(e,Number.POSITIVE_INFINITY);n.wr.forEachInRange([t,i],function(e){r=r.add(e.pr)})}),ef.resolve(this.Dr(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;eo.isDocumentKey(i)||(i=i.child(""));var a=new nJ(new eo(i),0),o=new eT(J);return this.wr.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)},a),ef.resolve(this.Dr(o))}},{key:"Dr",value:function(e){var t=this,n=[];return e.forEach(function(e){var r=t.Sr(e);null!==r&&n.push(r)}),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;0===this.Cr(t.batchId,"removed")||P(),this.mutationQueue.shift();var r=this.wr;return ef.forEach(t.mutations,function(i){var a=new nJ(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(function(){n.wr=r})}},{key:"Mn",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new nJ(t,0),r=this.wr.firstAfterOrEqual(n);return ef.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.mutationQueue.length,ef.resolve()}},{key:"Cr",value:function(e,t){return this.br(e)}},{key:"br",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"Sr",value:function(e){var t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),n0=function(){function e(t){(0,p.Z)(this,e),this.vr=t,this.docs=new ew(eo.comparator),this.size=0}return(0,m.Z)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return ef.resolve(n?n.document.mutableCopy():e$.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=tS;return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():e$.newInvalidDocument(e))}),ef.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){for(var i=tS,a=t.path,o=new eo(a.child("")),u=this.docs.getIteratorFrom(o);u.hasNext();){var s=u.getNext(),c=s.key,l=s.value.document;if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||0>=function(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=eo.comparator(e.documentKey,t.documentKey))?n:J(e.largestBatchId,t.largestBatchId)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(new es(l.readTime,l.key,-1),n)||(r.has(l.key)||tx(t,l))&&(i=i.insert(l.key,l.mutableCopy()))}return ef.resolve(i)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){P()}},{key:"Fr",value:function(e,t){return ef.forEach(this.docs,function(e){return t(e)})}},{key:"newChangeBuffer",value:function(e){return new n1(this)}},{key:"getSize",value:function(e){return ef.resolve(this.size)}}]),e}(),n1=function(e){(0,f.Z)(n,e);var t=S(n);function n(e){var r;return(0,p.Z)(this,n),(r=t.call(this)).ar=e,r}return(0,m.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach(function(r,i){i.isValidDocument()?n.push(t.ar.addEntry(e,i)):t.ar.removeEntry(r)}),ef.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.ar.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.ar.getEntries(e,t)}}]),n}(nQ),n2=function(){function e(t){(0,p.Z)(this,e),this.persistence=t,this.Mr=new tC(function(e){return tf(e)},td),this.lastRemoteSnapshotVersion=et.min(),this.highestTargetId=0,this.Or=0,this.Nr=new nX,this.targetCount=0,this.Lr=nK.Nn()}return(0,m.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.Mr.forEach(function(e,n){return t(n)}),ef.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return ef.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return ef.resolve(this.Or)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Lr.next(),ef.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),ef.resolve()}},{key:"qn",value:function(e){this.Mr.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Lr=new nK(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.qn(t),this.targetCount+=1,ef.resolve()}},{key:"updateTargetData",value:function(e,t){return this.qn(t),ef.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,ef.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Mr.forEach(function(o,u){u.sequenceNumber<=t&&null===n.get(u.targetId)&&(r.Mr.delete(o),a.push(r.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),ef.waitFor(a).next(function(){return i})}},{key:"getTargetCount",value:function(e){return ef.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Mr.get(t)||null;return ef.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.Nr.dr(t,n),ef.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.Nr.Rr(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),ef.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.Nr.Vr(t),ef.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.Nr.gr(t);return ef.resolve(n)}},{key:"containsKey",value:function(e,t){return ef.resolve(this.Nr.containsKey(t))}}]),e}(),n3=function(){function e(t,n){var r=this;(0,p.Z)(this,e),this.Br={},this.overlays={},this.kr=new ev(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new n2(this),this.indexManager=new nB,this.remoteDocumentCache=new n0(function(e){return r.referenceDelegate.Kr(e)}),this.serializer=new nU(n),this.$r=new nH(this.serializer)}return(0,m.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.qr=!1,Promise.resolve()}},{key:"started",get:function(){return this.qr}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new nY,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.Br[e.toKey()];return n||(n=new n$(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Qr}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.$r}},{key:"runTransaction",value:function(e,t,n){var r=this;M("MemoryPersistence","Starting transaction:",e);var i=new n4(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(function(e){return r.referenceDelegate.Wr(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})}},{key:"Gr",value:function(e,t){return ef.or(Object.values(this.Br).map(function(n){return function(){return n.containsKey(e,t)}}))}}]),e}(),n4=function(e){(0,f.Z)(n,e);var t=S(n);function n(e){var r;return(0,p.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return(0,m.Z)(n)}(ec),n5=function(){function e(t){(0,p.Z)(this,e),this.persistence=t,this.zr=new nX,this.jr=null}return(0,m.Z)(e,[{key:"Jr",get:function(){if(this.jr)return this.jr;throw P()}},{key:"addReference",value:function(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),ef.resolve()}},{key:"removeReference",value:function(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),ef.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Jr.add(t.toString()),ef.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.zr.Vr(t.targetId).forEach(function(e){return n.Jr.add(e.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.Jr.add(e.toString())})}).next(function(){return r.removeTargetData(e,t)})}},{key:"Ur",value:function(){this.jr=new Set}},{key:"Wr",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ef.forEach(this.Jr,function(r){var i=eo.fromPath(r);return t.Yr(e,i).next(function(e){e||n.removeEntry(i,et.min())})}).next(function(){return t.jr=null,n.apply(e)})}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.Yr(e,t).next(function(e){e?n.Jr.delete(t.toString()):n.Jr.add(t.toString())})}},{key:"Kr",value:function(e){return 0}},{key:"Yr",value:function(e,t){var n=this;return ef.or([function(){return ef.resolve(n.zr.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Gr(e,t)}])}}],[{key:"Hr",value:function(t){return new e(t)}}]),e}(),n9=function(){function e(t,n,r,i){(0,p.Z)(this,e),this.targetId=t,this.fromCache=n,this.qi=r,this.Qi=i}return(0,m.Z)(e,null,[{key:"Ki",value:function(t,n){var r,i=tV(),a=tV(),o=A(n.docChanges);try{for(o.s();!(r=o.n()).done;){var u=r.value;switch(u.type){case 0:i=i.add(u.doc.key);break;case 1:a=a.add(u.doc.key)}}}catch(e){o.e(e)}finally{o.f()}return new e(t,n.fromCache,i,a)}}]),e}(),n6=function(){function e(){(0,p.Z)(this,e),this._documentReadCount=0}return(0,m.Z)(e,[{key:"documentReadCount",get:function(){return this._documentReadCount}},{key:"incrementDocumentReadCount",value:function(e){this._documentReadCount+=e}}]),e}(),n8=function(){function e(){var t;(0,p.Z)(this,e),this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,T.G6)()?8:Number((t=(0,T.z$)().match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1")>0?6:4}return(0,m.Z)(e,[{key:"initialize",value:function(e,t){this.zi=e,this.indexManager=t,this.$i=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this,a={result:null};return this.ji(e,t).next(function(e){a.result=e}).next(function(){if(!a.result)return i.Hi(e,t,r,n).next(function(e){a.result=e})}).next(function(){if(!a.result){var n=new n6;return i.Ji(e,t,n).next(function(r){if(a.result=r,i.Ui)return i.Yi(e,t,n,r.size)})}}).next(function(){return a.result})}},{key:"Yi",value:function(e,t,n,r){return n.documentReadCount<this.Wi?(L()<=E.in.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",tb(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),ef.resolve()):(L()<=E.in.DEBUG&&M("QueryEngine","Query:",tb(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(L()<=E.in.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",tb(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,tw(t))):ef.resolve())}},{key:"ji",value:function(e,t){var n=this;if(tm(t))return ef.resolve(null);var r=tw(t);return this.indexManager.getIndexType(e,r).next(function(i){return 0===i?null:(null!==t.limit&&1===i&&(r=tw(t=tE(t,null,"F"))),n.indexManager.getDocumentsMatchingTarget(e,r).next(function(i){var a=tV.apply(void 0,(0,y.Z)(i));return n.zi.getDocuments(e,a).next(function(i){return n.indexManager.getMinOffset(e,r).next(function(r){var o=n.Zi(t,i);return n.Xi(t,o,a,r.readTime)?n.ji(e,tE(t,null,"F")):n.es(e,o,t,r)})})}))})}},{key:"Hi",value:function(e,t,n,r){var i=this;return tm(t)||r.isEqual(et.min())?ef.resolve(null):this.zi.getDocuments(e,n).next(function(a){var o=i.Zi(t,a);return i.Xi(t,o,n,r)?ef.resolve(null):(L()<=E.in.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),tb(t)),i.es(e,o,t,eu(r,-1)).next(function(e){return e}))})}},{key:"Zi",value:function(e,t){var n=new eT(tA(e));return t.forEach(function(t,r){tx(e,r)&&(n=n.add(r))}),n}},{key:"Xi",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Ji",value:function(e,t,n){return L()<=E.in.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",tb(t)),this.zi.getDocumentsMatchingQuery(e,t,es.min(),n)}},{key:"es",value:function(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next(function(e){return t.forEach(function(t){e=e.insert(t.key,t)}),e})}}]),e}(),n7=function(){function e(t,n,r,i){(0,p.Z)(this,e),this.persistence=t,this.ts=n,this.serializer=i,this.ns=new ew(J),this.rs=new tC(function(e){return tf(e)},td),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(r)}return(0,m.Z)(e,[{key:"_s",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new nW(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return e.collect(n,t.ns)})}}]),e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function re(e,t){return rt.apply(this,arguments)}function rt(){return(rt=(0,h.Z)(k().mark(function e(t,n){var r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,e.next=3,r.persistence.runTransaction("Handle user change","readonly",function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next(function(i){return t=i,r._s(n),r.mutationQueue.getAllMutationBatches(e)}).next(function(n){var i,a=[],o=[],u=tV(),s=A(t);try{for(s.s();!(i=s.n()).done;){var c=i.value;a.push(c.batchId);var l,h=A(c.mutations);try{for(h.s();!(l=h.n()).done;){var f=l.value;u=u.add(f.key)}}catch(e){h.e(e)}finally{h.f()}}}catch(e){s.e(e)}finally{s.f()}var d,v=A(n);try{for(v.s();!(d=v.n()).done;){var y=d.value;o.push(y.batchId);var p,m=A(y.mutations);try{for(m.s();!(p=m.n()).done;){var g=p.value;u=u.add(g.key)}}catch(e){m.e(e)}finally{m.f()}}}catch(e){v.e(e)}finally{v.f()}return r.localDocuments.getDocuments(e,u).next(function(e){return{us:e,removedBatchIds:a,addedBatchIds:o}})})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function rn(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Qr.getLastRemoteSnapshotVersion(t)})}function rr(e,t){return e.persistence.runTransaction("Allocate target","readwrite",function(n){var r;return e.Qr.getTargetData(n,t).next(function(i){return i?(r=i,ef.resolve(r)):e.Qr.allocateTargetId(n).next(function(i){return r=new nP(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Qr.addTargetData(n,r).next(function(){return r})})})}).then(function(n){var r=e.ns.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.ns=e.ns.insert(n.targetId,n),e.rs.set(t,n.targetId)),n})}function ri(e,t,n){return ra.apply(this,arguments)}function ra(){return(ra=(0,h.Z)(k().mark(function e(t,n,r){var i,a,o;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(i=t).ns.get(n),o=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",o,function(e){return i.persistence.referenceDelegate.removeTarget(e,a)});case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),ed(e.t1)){e.next=12;break}throw e.t1;case 12:M("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.ns=i.ns.remove(n),i.rs.delete(a.target);case 14:case"end":return e.stop()}},e,null,[[1,8]])}))).apply(this,arguments)}function ro(e,t,n){var r=et.min(),i=tV();return e.persistence.runTransaction("Execute query","readwrite",function(a){var o,u;return(o=tw(t),void 0!==(u=e.rs.get(o))?ef.resolve(e.ns.get(u)):e.Qr.getTargetData(a,o)).next(function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,e.Qr.getMatchingKeysForTargetId(a,t.targetId).next(function(e){i=e})}).next(function(){return e.ts.getDocumentsMatchingQuery(a,t,n?r:et.min(),n?i:tV())}).next(function(n){var r;return ru(e,(r=t).collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2)),n),{documents:n,hs:i}})})}function ru(e,t,n){var r=e.ss.get(t)||et.min();n.forEach(function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.ss.set(t,r)}var rs=function(){function e(){(0,p.Z)(this,e),this.activeTargetIds=tF}return(0,m.Z)(e,[{key:"As",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Rs",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"ds",value:function(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}]),e}(),rc=function(){function e(){(0,p.Z)(this,e),this.no=new rs,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,m.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.no.As(e),this.ro[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.ro[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.no.Rs(e)}},{key:"isLocalQueryTarget",value:function(e){return this.no.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.ro[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.no.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.no.activeTargetIds.has(e)}},{key:"start",value:function(){return this.no=new rs,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),rl=function(){function e(){(0,p.Z)(this,e)}return(0,m.Z)(e,[{key:"io",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),rh=function(){function e(){var t=this;(0,p.Z)(this,e),this.so=function(){return t.oo()},this._o=function(){return t.ao()},this.uo=[],this.co()}return(0,m.Z)(e,[{key:"io",value:function(e){this.uo.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}},{key:"co",value:function(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}},{key:"oo",value:function(){M("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=A(this.uo);try{for(t.s();!(e=t.n()).done;)(0,e.value)(0)}catch(e){t.e(e)}finally{t.f()}}},{key:"ao",value:function(){M("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=A(this.uo);try{for(t.s();!(e=t.n()).done;)(0,e.value)(1)}catch(e){t.e(e)}finally{t.f()}}}],[{key:"D",value:function(){return void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),rf=null;function rd(){return null===rf?rf=268435456+Math.round(2147483648*Math.random()):rf++,"0x"+rf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},ry=function(){function e(t){(0,p.Z)(this,e),this.lo=t.lo,this.ho=t.ho}return(0,m.Z)(e,[{key:"Po",value:function(e){this.Io=e}},{key:"To",value:function(e){this.Eo=e}},{key:"Ao",value:function(e){this.Ro=e}},{key:"onMessage",value:function(e){this.Vo=e}},{key:"close",value:function(){this.ho()}},{key:"send",value:function(e){this.lo(e)}},{key:"mo",value:function(){this.Io()}},{key:"fo",value:function(){this.Eo()}},{key:"po",value:function(e){this.Ro(e)}},{key:"yo",value:function(e){this.Vo(e)}}]),e}(),rp="WebChannelConnection",rm=function(e){(0,f.Z)(n,e);var t=S(n);function n(e){var r;return(0,p.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r.longPollingOptions=e.longPollingOptions,r}return(0,m.Z)(n,[{key:"Mo",value:function(e,t,n,r){var i=rd();return new Promise(function(a,o){var u=new b.JJ;u.setWithCredentials(!0),u.listenOnce(b.tw.COMPLETE,function(){try{switch(u.getLastErrorCode()){case b.jK.NO_ERROR:var t=u.getResponseJson();M(rp,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),a(t);break;case b.jK.TIMEOUT:M(rp,"RPC '".concat(e,"' ").concat(i," timed out")),o(new q(U.DEADLINE_EXCEEDED,"Request time out"));break;case b.jK.HTTP_ERROR:var n=u.getStatus();if(M(rp,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson();Array.isArray(r)&&(r=r[0]);var s=null==r?void 0:r.error;if(s&&s.status&&s.message){var c,l=(c=s.status.toLowerCase().replace(/_/g,"-"),Object.values(U).indexOf(c)>=0?c:U.UNKNOWN);o(new q(l,s.message))}else o(new q(U.UNKNOWN,"Server responded with status "+u.getStatus()))}else o(new q(U.UNAVAILABLE,"Connection failed."));break;default:P()}}finally{M(rp,"RPC '".concat(e,"' ").concat(i," completed."))}});var s=JSON.stringify(r);M(rp,"RPC '".concat(e,"' ").concat(i," sending request:"),r),u.send(t,"POST",s,n,15)})}},{key:"Oo",value:function(e,t,n){var i=rd(),a=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=(0,b.UE)(),u=(0,b.FJ)(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(s.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(s.xmlHttpFactory=new b.zI({})),this.Fo(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;var l=a.join("");M(rp,"Creating RPC '".concat(e,"' stream ").concat(i,": ").concat(l),s);var h=o.createWebChannel(l,s),f=!1,d=!1,v=new ry({lo:function(t){d?M(rp,"Not sending because RPC '".concat(e,"' stream ").concat(i," is closed:"),t):(f||(M(rp,"Opening RPC '".concat(e,"' stream ").concat(i," transport.")),h.open(),f=!0),M(rp,"RPC '".concat(e,"' stream ").concat(i," sending:"),t),h.send(t))},ho:function(){return h.close()}}),y=function(e,t,n){e.listen(t,function(e){try{n(e)}catch(e){setTimeout(function(){throw e},0)}})};return y(h,b.ii.EventType.OPEN,function(){d||(M(rp,"RPC '".concat(e,"' stream ").concat(i," transport opened.")),v.mo())}),y(h,b.ii.EventType.CLOSE,function(){d||(d=!0,M(rp,"RPC '".concat(e,"' stream ").concat(i," transport closed")),v.po())}),y(h,b.ii.EventType.ERROR,function(t){d||(d=!0,F(rp,"RPC '".concat(e,"' stream ").concat(i," transport errored:"),t),v.po(new q(U.UNAVAILABLE,"The operation could not be completed")))}),y(h,b.ii.EventType.MESSAGE,function(t){var n;if(!d){var a=t.data[0];a||P();var o=a.error||(null===(n=a[0])||void 0===n?void 0:n.error);if(o){M(rp,"RPC '".concat(e,"' stream ").concat(i," received error:"),o);var u=o.status,s=function(e){var t=r[e];if(void 0!==t)return ni(t)}(u),c=o.message;void 0===s&&(s=U.INTERNAL,c="Unknown error status: "+u+" with message "+o.message),d=!0,v.po(new q(s,c)),h.close()}else M(rp,"RPC '".concat(e,"' stream ").concat(i," received:"),a),v.yo(a)}}),y(u,b.ju.STAT_EVENT,function(t){t.stat===b.kN.PROXY?M(rp,"RPC '".concat(e,"' stream ").concat(i," detected buffering proxy")):t.stat===b.kN.NOPROXY&&M(rp,"RPC '".concat(e,"' stream ").concat(i," detected no buffering proxy"))}),setTimeout(function(){v.fo()},0),v}}]),n}(function(){function e(t){(0,p.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.wo=n+"://"+t.host,this.So="projects/".concat(r,"/databases/").concat(i),this.bo="(default)"===this.databaseId.database?"project_id=".concat(r):"project_id=".concat(r,"&database_id=").concat(i)}return(0,m.Z)(e,[{key:"Do",get:function(){return!1}},{key:"Co",value:function(e,t,n,r,i){var a=rd(),o=this.vo(e,t.toUriEncodedString());M("RestConnection","Sending RPC '".concat(e,"' ").concat(a,":"),o,n);var u={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(u,r,i),this.Mo(e,o,u,n).then(function(t){return M("RestConnection","Received RPC '".concat(e,"' ").concat(a,": "),t),t},function(t){throw F("RestConnection","RPC '".concat(e,"' ").concat(a," failed with error: "),t,"url: ",o,"request:",n),t})}},{key:"xo",value:function(e,t,n,r,i,a){return this.Co(e,t,n,r,i)}},{key:"Fo",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Z,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(function(t,n){return e[n]=t}),n&&n.headers.forEach(function(t,n){return e[n]=t})}},{key:"vo",value:function(e,t){var n=rv[e];return"".concat(this.wo,"/v1/").concat(t,":").concat(n)}},{key:"terminate",value:function(){}}]),e}());function rg(){return"undefined"!=typeof document?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rk(e){return new nE(e,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rw=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,p.Z)(this,e),this.oi=t,this.timerId=n,this.No=r,this.Lo=i,this.Bo=a,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}return(0,m.Z)(e,[{key:"reset",value:function(){this.ko=0}},{key:"Ko",value:function(){this.ko=this.Bo}},{key:"$o",value:function(e){var t=this;this.cancel();var n=Math.floor(this.ko+this.Uo()),r=Math.max(0,Date.now()-this.Qo),i=Math.max(0,n-r);i>0&&M("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.ko," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,function(){return t.Qo=Date.now(),e()}),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}},{key:"Wo",value:function(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}},{key:"cancel",value:function(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}},{key:"Uo",value:function(){return(Math.random()-.5)*this.ko}}]),e}(),r_=function(){var e,t,n;function r(e,t,n,i,a,o,u,s){(0,p.Z)(this,r),this.oi=e,this.Go=n,this.zo=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=s,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new rw(e,t)}return(0,m.Z)(r,[{key:"Zo",value:function(){return 1===this.state||5===this.state||this.Xo()}},{key:"Xo",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.e_()}},{key:"stop",value:(e=(0,h.Z)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.Zo(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"t_",value:function(){this.state=0,this.Yo.reset()}},{key:"n_",value:function(){var e=this;this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,function(){return e.r_()}))}},{key:"i_",value:function(e){this.s_(),this.stream.send(e)}},{key:"r_",value:(t=(0,h.Z)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Xo()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"s_",value:function(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}},{key:"o_",value:function(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}},{key:"close",value:(n=(0,h.Z)(k().mark(function e(t,n){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.s_(),this.o_(),this.Yo.cancel(),this.jo++,4!==t?this.Yo.reset():n&&n.code===U.RESOURCE_EXHAUSTED?(V(n.toString()),V("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):n&&n.code===U.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.__(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Ao(n);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"__",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.a_(this.jo),n=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(function(t){var r=(0,c.Z)(t,2),i=r[0],a=r[1];e.jo===n&&e.u_(i,a)},function(n){t(function(){var t=new q(U.UNKNOWN,"Fetching auth token failed: "+n.message);return e.c_(t)})})}},{key:"u_",value:function(e,t){var n=this,r=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(function(){r(function(){return n.listener.Po()})}),this.stream.To(function(){r(function(){return n.state=2,n.Jo=n.oi.enqueueAfterDelay(n.zo,1e4,function(){return n.Xo()&&(n.state=3),Promise.resolve()}),n.listener.To()})}),this.stream.Ao(function(e){r(function(){return n.c_(e)})}),this.stream.onMessage(function(e){r(function(){return n.onMessage(e)})})}},{key:"e_",value:function(){var e=this;this.state=5,this.Yo.$o((0,h.Z)(k().mark(function t(){return k().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}},t)})))}},{key:"c_",value:function(e){return M("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"a_",value:function(e){var t=this;return function(n){t.oi.enqueueAndForget(function(){return t.jo===e?n():(M("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}}}]),r}(),rE=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i,a,o,u){var s;return(0,p.Z)(this,n),(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,u)).serializer=o,s}return(0,m.Z)(n,[{key:"l_",value:function(e,t){return this.connection.Oo("Listen",e,t)}},{key:"onMessage",value:function(e){this.Yo.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r,i,a="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:P(),o=t.targetChange.targetIds||[],u=(i=t.targetChange.resumeToken,e.useProto3Json?(void 0===i||"string"==typeof i||P(),eA.fromBase64String(i||"")):(void 0===i||i instanceof x||i instanceof Uint8Array||P(),eA.fromUint8Array(i||new Uint8Array))),s=t.targetChange.cause;n=new nv(a,o,u,s&&new q(void 0===s.code?U.UNKNOWN:ni(s.code),s.message||"")||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var l=nD(e,c.document.name),h=nx(c.document.updateTime),f=c.document.createTime?nx(c.document.createTime):et.min(),d=new eJ({mapValue:{fields:c.document.fields}}),v=e$.newFoundDocument(l,h,f,d);n=new nf(c.targetIds||[],c.removedTargetIds||[],v.key,v)}else if("documentDelete"in t){t.documentDelete;var y=t.documentDelete;y.document;var p=nD(e,y.document),m=y.readTime?nx(y.readTime):et.min(),g=e$.newNoDocument(p,m);n=new nf([],y.removedTargetIds||[],g.key,g)}else if("documentRemove"in t){t.documentRemove;var k=t.documentRemove;k.document;var w=nD(e,k.document);n=new nf([],k.removedTargetIds||[],w,null)}else{if(!("filter"in t))return P();t.filter;var _=t.filter;_.targetId;var E=_.count,T=new nr(void 0===E?0:E,_.unchangedNames);n=new nd(_.targetId,T)}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return et.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?et.min():t.readTime?nx(t.readTime):et.min()}(e);return this.listener.h_(t,n)}},{key:"P_",value:function(e){var t,n={};n.database=nR(this.serializer),n.addTarget=function(e,t){var n,r,i,a,o,u,s,c,l,h=t.target;if((l=tv(h)?{documents:{documents:[nZ(e,h.path)]}}:{query:(a={structuredQuery:{}},o=h.path,null!==h.collectionGroup?(i=o,a.structuredQuery.from=[{collectionId:h.collectionGroup,allDescendants:!0}]):(i=o.popLast(),a.structuredQuery.from=[{collectionId:o.lastSegment()}]),a.parent=nZ(e,i),(u=function(e){if(0!==e.length)return function e(t){var n;return t instanceof e5?function(e){if("=="===e.op){if(eW(e.value))return{unaryFilter:{field:nV(e.field),op:"IS_NAN"}};if(ej(e.value))return{unaryFilter:{field:nV(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(eW(e.value))return{unaryFilter:{field:nV(e.field),op:"IS_NOT_NAN"}};if(ej(e.value))return{unaryFilter:{field:nV(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:nV(e.field),op:nw[e.op],value:e.value}}}(t):t instanceof e9?1===(n=t.getFilters().map(function(t){return e(t)})).length?n[0]:{compositeFilter:{op:n_[t.op],filters:n}}:P()}(e9.create(e,"and"))}(h.filters))&&(a.structuredQuery.where=u),(s=function(e){if(0!==e.length)return e.map(function(e){return{field:nV(e.field),direction:nk[e.dir]}})}(h.orderBy))&&(a.structuredQuery.orderBy=s),null!==(c=nT(e,h.limit))&&(a.structuredQuery.limit=c),h.startAt&&(a.structuredQuery.startAt={before:(n=h.startAt).inclusive,values:n.position}),h.endAt&&(a.structuredQuery.endAt={before:!(r=h.endAt).inclusive,values:r.position}),{_t:a,parent:i})._t}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){l.resumeToken=nb(e,t.resumeToken);var f=nT(e,t.expectedCount);null!==f&&(l.expectedCount=f)}else if(t.snapshotVersion.compareTo(et.min())>0){l.readTime=nI(e,t.snapshotVersion.toTimestamp());var d=nT(e,t.expectedCount);null!==d&&(l.expectedCount=d)}return l}(this.serializer,e);var r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return P()}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.i_(n)}},{key:"I_",value:function(e){var t={};t.database=nR(this.serializer),t.removeTarget=e,this.i_(t)}}]),n}(r_),rT=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i,a,o,u){var s;return(0,p.Z)(this,n),(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,u)).serializer=o,s.T_=!1,s}return(0,m.Z)(n,[{key:"E_",get:function(){return this.T_}},{key:"start",value:function(){this.T_=!1,this.lastStreamToken=void 0,(0,s.Z)((0,v.Z)(n.prototype),"start",this).call(this)}},{key:"__",value:function(){this.T_&&this.d_([])}},{key:"l_",value:function(e,t){return this.connection.Oo("Write",e,t)}},{key:"onMessage",value:function(e){if(e.streamToken||P(),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();var t,n,r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(void 0!==n||P(),t.map(function(e){var t;return(t=e.updateTime?nx(e.updateTime):nx(n)).isEqual(et.min())&&(t=nx(n)),new tY(t,e.transformResults||[])})):[]),i=nx(e.commitTime);return this.listener.A_(i,r)}return e.writeResults&&0!==e.writeResults.length&&P(),this.T_=!0,this.listener.R_()}},{key:"V_",value:function(){var e={};e.database=nR(this.serializer),this.i_(e)}},{key:"d_",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map(function(e){return function(e,t){var n,r,i,a;if(t instanceof t3)n={update:nM(e,t.key,t.value)};else if(t instanceof t8)n={delete:nN(e,t.key)};else if(t instanceof t4)n={update:nM(e,t.key,t.data),updateMask:(i=t.fieldMask,a=[],i.fields.forEach(function(e){return a.push(e.canonicalString())}),{fieldPaths:a})};else{if(!(t instanceof t7))return P();n={verify:nN(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(e){return function(e,t){var n=t.transform;if(n instanceof tB)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof tz)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof tK)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof tj)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw P()}(0,e)})),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:nI(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:P()),n}(t.serializer,e)})};this.i_(n)}}]),n}(r_),rI=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i,a){var o;return(0,p.Z)(this,n),(o=t.call(this)).authCredentials=e,o.appCheckCredentials=r,o.connection=i,o.serializer=a,o.m_=!1,o}return(0,m.Z)(n,[{key:"f_",value:function(){if(this.m_)throw new q(U.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Co",value:function(e,t,n,r){var i=this;return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(a){var o=(0,c.Z)(a,2),u=o[0],s=o[1];return i.connection.Co(e,nC(t,n),r,u,s)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===U.UNAUTHENTICATED&&(i.authCredentials.invalidateToken(),i.appCheckCredentials.invalidateToken()),e):new q(U.UNKNOWN,e.toString())})}},{key:"xo",value:function(e,t,n,r,i){var a=this;return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(o){var u=(0,c.Z)(o,2),s=u[0],l=u[1];return a.connection.xo(e,nC(t,n),r,s,l,i)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===U.UNAUTHENTICATED&&(a.authCredentials.invalidateToken(),a.appCheckCredentials.invalidateToken()),e):new q(U.UNKNOWN,e.toString())})}},{key:"terminate",value:function(){this.m_=!0,this.connection.terminate()}}]),n}((0,m.Z)(function e(){(0,p.Z)(this,e)})),rb=function(){function e(t,n){(0,p.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}return(0,m.Z)(e,[{key:"w_",value:function(){var e=this;0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return e.p_=null,e.b_("Backend didn't respond within 10 seconds."),e.S_("Offline"),Promise.resolve()}))}},{key:"D_",value:function(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.S_("Offline")))}},{key:"set",value:function(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}},{key:"S_",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"b_",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.y_?(V(t),this.y_=!1):M("OnlineStateTracker",t)}},{key:"C_",value:function(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}]),e}(),rx=(0,m.Z)(function e(t,n,r,i,a){var o=this;(0,p.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=a,this.O_.io(function(e){r.enqueueAndForget((0,h.Z)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=rF(o),!e.t0){e.next=5;break}return M("RemoteStore","Restarting streams for network reachability change."),e.next=5,(function(){var e=(0,h.Z)(k().mark(function e(t){var n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t).M_.add(4),e.next=4,rS(n);case 4:return n.N_.set("Unknown"),n.M_.delete(4),e.next=8,rA(n);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}})()(o);case 5:case"end":return e.stop()}},e)})))}),this.N_=new rb(r,i)});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rA(e){return rC.apply(this,arguments)}function rC(){return(rC=(0,h.Z)(k().mark(function e(t){var n,r,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!rF(t)){e.next=18;break}n=A(t.x_),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}},e,null,[[2,12,15,18]])}))).apply(this,arguments)}function rS(e){return rN.apply(this,arguments)}function rN(){return(rN=(0,h.Z)(k().mark(function e(t){var n,r,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=A(t.x_),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}},e,null,[[1,11,14,17]])}))).apply(this,arguments)}function rD(e,t){e.F_.has(t.targetId)||(e.F_.set(t.targetId,t),rV(e)?rM(e):ie(e).Xo()&&rR(e,t))}function rZ(e,t){var n=ie(e);e.F_.delete(t),n.Xo()&&rL(e,t),0===e.F_.size&&(n.Xo()?n.n_():rF(e)&&e.N_.set("Unknown"))}function rR(e,t){if(e.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(et.min())>0){var n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}ie(e).P_(t)}function rL(e,t){e.L_.xe(t),ie(e).I_(t)}function rM(e){e.L_=new np({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},ot:function(t){return e.F_.get(t)||null},tt:function(){return e.datastore.serializer.databaseId}}),ie(e).start(),e.N_.w_()}function rV(e){return rF(e)&&!ie(e).Zo()&&e.F_.size>0}function rF(e){return 0===e.M_.size}function rO(e){return rP.apply(this,arguments)}function rP(){return(rP=(0,h.Z)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.N_.set("Online");case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function rU(e){return rq.apply(this,arguments)}function rq(){return(rq=(0,h.Z)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.F_.forEach(function(e,n){rR(t,e)});case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function rB(e,t){return rz.apply(this,arguments)}function rz(){return(rz=(0,h.Z)(k().mark(function e(t,n){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.L_=void 0,rV(t)?(t.N_.D_(n),rM(t)):t.N_.set("Unknown");case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function rG(e,t,n){return rK.apply(this,arguments)}function rK(){return(rK=(0,h.Z)(k().mark(function e(t,n,r){var i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.N_.set("Online"),!(n instanceof nv)||2!==n.state||!n.cause){e.next=13;break}return e.prev=1,e.next=4,(function(){var e=(0,h.Z)(k().mark(function e(t,n){var r,i,a,o;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=A(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(o=a.value,e.t0=t.F_.has(o),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(o,r);case 10:t.F_.delete(o),t.L_.removeTarget(o);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}},e,null,[[2,16,19,22]])}));return function(t,n){return e.apply(this,arguments)}})()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),M("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,rQ(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof nf?t.L_.Ke(n):n instanceof nd?t.L_.He(n):t.L_.We(n),r.isEqual(et.min())){e.next=29;break}return e.prev=14,e.next=17,rn(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.L_.rt(t);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.F_.get(r);i&&e.F_.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(function(t,n){var r=e.F_.get(t);r&&(e.F_.set(t,r.withResumeToken(eA.EMPTY_BYTE_STRING,r.snapshotVersion)),rL(e,t),rR(e,new nP(r.target,t,n,r.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),M("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,rQ(t,e.t2);case 29:case"end":return e.stop()}},e,null,[[1,6],[14,24]])}))).apply(this,arguments)}function rQ(e,t,n){return rj.apply(this,arguments)}function rj(){return(rj=(0,h.Z)(k().mark(function e(t,n,r){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ed(n)){e.next=2;break}throw n;case 2:return t.M_.add(1),e.next=5,rS(t);case 5:t.N_.set("Offline"),r||(r=function(){return rn(t.localStore)}),t.asyncQueue.enqueueRetryable((0,h.Z)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return M("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.M_.delete(1),e.next=6,rA(t);case 6:case"end":return e.stop()}},e)})));case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function rW(e,t){return t().catch(function(n){return rQ(e,n,t)})}function rH(e){return rY.apply(this,arguments)}function rY(){return(rY=(0,h.Z)(k().mark(function e(t){var n,r,i,a;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=it(n=t),i=n.v_.length>0?n.v_[n.v_.length-1].batchId:-1;case 2:var o;if(!(rF(o=n)&&o.v_.length<10)){e.next=19;break}return e.prev=3,e.next=6,function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})}(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.v_.length&&r.n_(),e.abrupt("break",19);case 10:i=a.batchId,function(e,t){e.v_.push(t);var n=it(e);n.Xo()&&n.E_&&n.d_(t.mutations)}(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,rQ(n,e.t0);case 17:e.next=2;break;case 19:rX(n)&&rJ(n);case 20:case"end":return e.stop()}},e,null,[[3,13]])}))).apply(this,arguments)}function rX(e){return rF(e)&&!it(e).Zo()&&e.v_.length>0}function rJ(e){it(e).start()}function r$(e){return r0.apply(this,arguments)}function r0(){return(r0=(0,h.Z)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:it(t).V_();case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function r1(e){return r2.apply(this,arguments)}function r2(){return(r2=(0,h.Z)(k().mark(function e(t){var n,r,i,a;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=it(t),r=A(t.v_);try{for(r.s();!(i=r.n()).done;)a=i.value,n.d_(a.mutations)}catch(e){r.e(e)}finally{r.f()}case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function r3(e,t,n){return r4.apply(this,arguments)}function r4(){return(r4=(0,h.Z)(k().mark(function e(t,n,r){var i,a;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.v_.shift(),a=nt.from(i,n,r),e.next=3,rW(t,function(){return t.remoteSyncer.applySuccessfulWrite(a)});case 3:return e.next=5,rH(t);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function r5(e,t){return r9.apply(this,arguments)}function r9(){return(r9=(0,h.Z)(k().mark(function e(t,n){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&it(t).E_,!e.t0){e.next=4;break}return e.next=4,(function(){var e=(0,h.Z)(k().mark(function e(t,n){var r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:var i;if(!(function(e){switch(e){default:return P();case U.CANCELLED:case U.UNKNOWN:case U.DEADLINE_EXCEEDED:case U.RESOURCE_EXHAUSTED:case U.INTERNAL:case U.UNAVAILABLE:case U.UNAUTHENTICATED:return!1;case U.INVALID_ARGUMENT:case U.NOT_FOUND:case U.ALREADY_EXISTS:case U.PERMISSION_DENIED:case U.FAILED_PRECONDITION:case U.ABORTED:case U.OUT_OF_RANGE:case U.UNIMPLEMENTED:case U.DATA_LOSS:return!0}}(i=n.code)&&i!==U.ABORTED)){e.next=7;break}return r=t.v_.shift(),it(t).t_(),e.next=5,rW(t,function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)});case 5:return e.next=7,rH(t);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}})()(t,n);case 4:rX(t)&&rJ(t);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function r6(e,t){return r8.apply(this,arguments)}function r8(){return(r8=(0,h.Z)(k().mark(function e(t,n){var r,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=t).asyncQueue.verifyOperationInProgress(),M("RemoteStore","RemoteStore received new credentials"),i=rF(r),r.M_.add(3),e.next=6,rS(r);case 6:return i&&r.N_.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.M_.delete(3),e.next=12,rA(r);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function r7(){return(r7=(0,h.Z)(k().mark(function e(t,n){var r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,!n){e.next=7;break}return r.M_.delete(2),e.next=5,rA(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.M_.add(2),e.next=12,rS(r);case 12:r.N_.set("Unknown");case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ie(e){var t,n,r,i;return e.B_||(e.B_=(t=e.datastore,n=e.asyncQueue,r={Po:rO.bind(null,e),To:rU.bind(null,e),Ao:rB.bind(null,e),h_:rG.bind(null,e)},t.f_(),new rE(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r)),e.x_.push((i=(0,h.Z)(k().mark(function t(n){return k().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.B_.t_(),rV(e)?rM(e):e.N_.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.B_.stop();case 6:e.L_=void 0;case 7:case"end":return t.stop()}},t)})),function(e){return i.apply(this,arguments)}))),e.B_}function it(e){var t,n,r,i;return e.k_||(e.k_=(t=e.datastore,n=e.asyncQueue,r={Po:function(){return Promise.resolve()},To:r$.bind(null,e),Ao:r5.bind(null,e),R_:r1.bind(null,e),A_:r3.bind(null,e)},t.f_(),new rT(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r)),e.x_.push((i=(0,h.Z)(k().mark(function t(n){return k().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.k_.t_(),t.next=4,rH(e);case 4:t.next=9;break;case 6:return t.next=8,e.k_.stop();case 8:e.v_.length>0&&(M("RemoteStore","Stopping write stream with ".concat(e.v_.length," pending writes")),e.v_=[]);case 9:case"end":return t.stop()}},t)})),function(e){return i.apply(this,arguments)}))),e.k_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ir=function(){function e(t,n,r,i,a){(0,p.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new B,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}return(0,m.Z)(e,[{key:"promise",get:function(){return this.deferred.promise}},{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new q(U.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)})}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}}]),e}();function ii(e,t){if(V("AsyncQueue","".concat(t,": ").concat(e)),ed(e))return new q(U.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ia=function(){function e(t){(0,p.Z)(this,e),this.comparator=t?function(e,n){return t(e,n)||eo.comparator(e.key,n.key)}:function(e,t){return eo.comparator(e.key,t.key)},this.keyedMap=tD(),this.sortedSet=new ew(this.comparator)}return(0,m.Z)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal(function(t,n){return e(t),!1})}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),io=function(){function e(){(0,p.Z)(this,e),this.q_=new ew(eo.comparator)}return(0,m.Z)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):P():this.q_=this.q_.insert(t,e)}},{key:"Q_",value:function(){var e=[];return this.q_.inorderTraversal(function(t,n){e.push(n)}),e}}]),e}(),iu=function(){function e(t,n,r,i,a,o,u,s,c){(0,p.Z)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=s,this.hasCachedResults=c}return(0,m.Z)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&tT(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i,a){var o=[];return n.forEach(function(e){o.push({type:0,doc:e})}),new e(t,n,ia.emptySet(n),o,r,i,!0,!1,a)}}]),e}(),is=function(){function e(){(0,p.Z)(this,e),this.K_=void 0,this.U_=[]}return(0,m.Z)(e,[{key:"W_",value:function(){return this.U_.some(function(e){return e.G_()})}}]),e}(),ic=(0,m.Z)(function e(){(0,p.Z)(this,e),this.queries=new tC(function(e){return tI(e)},tT),this.onlineState="Unknown",this.z_=new Set});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function il(e,t){return ih.apply(this,arguments)}function ih(){return(ih=(0,h.Z)(k().mark(function e(t,n){var r,i,a,o,u;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t,i=3,a=n.query,(o=r.queries.get(a))?!o.W_()&&n.G_()&&(i=2):(o=new is,i=n.G_()?0:1),e.prev=5,e.t0=i,e.next=0===e.t0?9:1===e.t0?13:2===e.t0?17:19;break;case 9:return e.next=11,r.onListen(a,!0);case 11:case 15:return o.K_=e.sent,e.abrupt("break",19);case 13:return e.next=15,r.onListen(a,!1);case 17:return e.next=19,r.onFirstRemoteStoreListen(a);case 19:e.next=25;break;case 21:return e.prev=21,e.t1=e.catch(5),u=ii(e.t1,"Initialization of query '".concat(tb(n.query),"' failed")),e.abrupt("return",void n.onError(u));case 25:r.queries.set(a,o),o.U_.push(n),n.j_(r.onlineState),o.K_&&n.H_(o.K_)&&im(r);case 26:case"end":return e.stop()}},e,null,[[5,21]])}))).apply(this,arguments)}function id(e,t){return iv.apply(this,arguments)}function iv(){return(iv=(0,h.Z)(k().mark(function e(t,n){var r,i,a,o,u;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t,i=n.query,a=3,(o=r.queries.get(i))&&(u=o.U_.indexOf(n))>=0&&(o.U_.splice(u,1),0===o.U_.length?a=n.G_()?0:1:!o.W_()&&n.G_()&&(a=2)),e.t0=a,e.next=0===e.t0?7:1===e.t0?8:2===e.t0?9:10;break;case 7:return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i,!0)));case 8:return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i,!1)));case 9:return e.abrupt("return",r.onLastRemoteStoreUnlisten(i));case 10:return e.abrupt("return");case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iy(e,t){var n,r=!1,i=A(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.query,u=e.queries.get(o);if(u){var s,c=A(u.U_);try{for(c.s();!(s=c.n()).done;)s.value.H_(a)&&(r=!0)}catch(e){c.e(e)}finally{c.f()}u.K_=a}}}catch(e){i.e(e)}finally{i.f()}r&&im(e)}function ip(e,t,n){var r=e.queries.get(t);if(r){var i,a=A(r.U_);try{for(a.s();!(i=a.n()).done;)i.value.onError(n)}catch(e){a.e(e)}finally{a.f()}}e.queries.delete(t)}function im(e){e.z_.forEach(function(e){e.next()})}(o=a||(a={})).J_="default",o.Cache="cache";var ig=function(){function e(t,n,r){(0,p.Z)(this,e),this.query=t,this.Y_=n,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}return(0,m.Z)(e,[{key:"H_",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=A(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}e=new iu(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}var a=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),a=!0):this.ta(e,this.onlineState)&&(this.na(e),a=!0),this.X_=e,a}},{key:"onError",value:function(e){this.Y_.error(e)}},{key:"j_",value:function(e){this.onlineState=e;var t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}},{key:"ta",value:function(e,t){return!(e.fromCache&&this.G_())||(!this.options.ra||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}},{key:"ea",value:function(e){if(e.docChanges.length>0)return!0;var t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"na",value:function(e){e=iu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}},{key:"G_",value:function(){return this.options.source!==a.Cache}}]),e}(),ik=(0,m.Z)(function e(t){(0,p.Z)(this,e),this.key=t}),iw=(0,m.Z)(function e(t){(0,p.Z)(this,e),this.key=t}),i_=function(){function e(t,n){(0,p.Z)(this,e),this.query=t,this.la=n,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=tV(),this.mutatedKeys=tV(),this.Ia=tA(t),this.Ta=new ia(this.Ia)}return(0,m.Z)(e,[{key:"Ea",get:function(){return this.la}},{key:"da",value:function(e,t){var n=this,r=t?t.Aa:new io,i=t?t.Ta:this.Ta,a=t?t.mutatedKeys:this.mutatedKeys,o=i,u=!1,s="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(function(e,t){var l=i.get(e),h=tx(n.query,t)?t:null,f=!!l&&n.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),v=!1;l&&h?l.data.isEqual(h.data)?f!==d&&(r.track({type:3,doc:h}),v=!0):n.Ra(l,h)||(r.track({type:2,doc:h}),v=!0,(s&&n.Ia(h,s)>0||c&&0>n.Ia(h,c))&&(u=!0)):!l&&h?(r.track({type:0,doc:h}),v=!0):l&&!h&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(u=!0)),v&&(h?(o=o.add(h),a=d?a.add(e):a.delete(e)):(o=o.delete(e),a=a.delete(e)))}),null!==this.query.limit)for(;o.size>this.query.limit;){var l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Ta:o,Aa:r,Xi:u,mutatedKeys:a}}},{key:"Ra",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n,r){var i=this,a=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;var o=e.Aa.Q_();o.sort(function(e,t){var n,r,a;return n=e.type,r=t.type,(a=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return P()}})(n)-a(r)||i.Ia(e.doc,t.doc)}),this.Va(n),r=null!=r&&r;var u=t&&!r?this.ma():[],s=0===this.Pa.size&&this.current&&!r?1:0,c=s!==this.ha;return(this.ha=s,0!==o.length||c)?{snapshot:new iu(this.query,e.Ta,a,o,e.mutatedKeys,0===s,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:u}:{fa:u}}},{key:"j_",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new io,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}},{key:"ga",value:function(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}},{key:"Va",value:function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t.la=t.la.add(e)}),e.modifiedDocuments.forEach(function(e){}),e.removedDocuments.forEach(function(e){return t.la=t.la.delete(e)}),this.current=e.current)}},{key:"ma",value:function(){var e=this;if(!this.current)return[];var t=this.Pa;this.Pa=tV(),this.Ta.forEach(function(t){e.ga(t.key)&&(e.Pa=e.Pa.add(t.key))});var n=[];return t.forEach(function(t){e.Pa.has(t)||n.push(new iw(t))}),this.Pa.forEach(function(e){t.has(e)||n.push(new ik(e))}),n}},{key:"pa",value:function(e){this.la=e.hs,this.Pa=tV();var t=this.da(e.documents);return this.applyChanges(t,!0)}},{key:"ya",value:function(){return iu.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}]),e}(),iE=(0,m.Z)(function e(t,n,r){(0,p.Z)(this,e),this.query=t,this.targetId=n,this.view=r}),iT=(0,m.Z)(function e(t){(0,p.Z)(this,e),this.key=t,this.wa=!1}),iI=function(){function e(t,n,r,i,a,o){(0,p.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new tC(function(e){return tI(e)},tT),this.Da=new Map,this.Ca=new Set,this.va=new ew(eo.comparator),this.Fa=new Map,this.Ma=new nX,this.xa={},this.Oa=new Map,this.Na=nK.Ln(),this.onlineState="Unknown",this.La=void 0}return(0,m.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.La}}]),e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ib(e,t){return ix.apply(this,arguments)}function ix(){return(ix=(0,h.Z)(k().mark(function e(t,n){var r,i,a,o,u=arguments;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(u.length>2)||void 0===u[2]||u[2],!(o=(i=i6(t)).ba.get(n))){e.next=7;break}i.sharedClientState.addLocalQueryTarget(o.targetId),a=o.view.ya(),e.next=10;break;case 7:return e.next=9,iS(i,n,r,!0);case 9:a=e.sent;case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iA(e,t){return iC.apply(this,arguments)}function iC(){return(iC=(0,h.Z)(k().mark(function e(t,n){var r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i6(t),e.next=3,iS(r,n,!0,!1);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iS(e,t,n,r){return iN.apply(this,arguments)}function iN(){return(iN=(0,h.Z)(k().mark(function e(t,n,r,i){var a,o,u,s;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,rr(t.localStore,tw(n));case 2:if(o=(a=e.sent).targetId,u=r?t.sharedClientState.addLocalQueryTarget(o):"not-current",e.t0=i,!e.t0){e.next=10;break}return e.next=9,iD(t,n,o,"current"===u,a.resumeToken);case 9:s=e.sent;case 10:return t.isPrimaryClient&&r&&rD(t.remoteStore,a),e.abrupt("return",s);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iD(e,t,n,r,i){return iZ.apply(this,arguments)}function iZ(){return(iZ=(0,h.Z)(k().mark(function e(t,n,r,i,a){var o,u,s,c,l,f;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.Ba=function(e,n,r){return(function(){var e=(0,h.Z)(k().mark(function e(t,n,r,i){var a,o,u,s;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.da(r),e.t0=a.Xi,!e.t0){e.next=6;break}return e.next=5,ro(t.localStore,n.query,!1).then(function(e){var t=e.documents;return n.view.da(t,a)});case 5:a=e.sent;case 6:return o=i&&i.targetChanges.get(n.targetId),u=i&&null!=i.targetMismatches.get(n.targetId),s=n.view.applyChanges(a,t.isPrimaryClient,o,u),e.abrupt("return",(iJ(t,n.targetId,s.fa),s.snapshot));case 8:case"end":return e.stop()}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}})()(t,e,n,r)},e.next=3,ro(t.localStore,n,!0);case 3:return s=(u=new i_(n,(o=e.sent).hs)).da(o.documents),c=nh.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState,a),l=u.applyChanges(s,t.isPrimaryClient,c),iJ(t,r,l.fa),f=new iE(n,r,u),e.abrupt("return",(t.ba.set(n,f),t.Da.has(r)?t.Da.get(r).push(n):t.Da.set(r,[n]),l.snapshot));case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iR(e,t,n){return iL.apply(this,arguments)}function iL(){return(iL=(0,h.Z)(k().mark(function e(t,n,r){var i,a,o;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(i=t).ba.get(n),!((o=i.Da.get(a.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(i.Da.set(a.targetId,o.filter(function(e){return!tT(e,n)})),void i.ba.delete(n)));case 3:if(!i.isPrimaryClient){e.next=11;break}if(i.sharedClientState.removeLocalQueryTarget(a.targetId),e.t0=i.sharedClientState.isActiveQueryTarget(a.targetId),e.t0){e.next=9;break}return e.next=9,ri(i.localStore,a.targetId,!1).then(function(){i.sharedClientState.clearQueryState(a.targetId),r&&rZ(i.remoteStore,a.targetId),iY(i,a.targetId)}).catch(el);case 9:e.next=14;break;case 11:return iY(i,a.targetId),e.next=14,ri(i.localStore,a.targetId,!0);case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iM(e,t){return iV.apply(this,arguments)}function iV(){return(iV=(0,h.Z)(k().mark(function e(t,n){var r,i,a;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=(r=t).ba.get(n),a=r.Da.get(i.targetId),r.isPrimaryClient&&1===a.length&&(r.sharedClientState.removeLocalQueryTarget(i.targetId),rZ(r.remoteStore,i.targetId));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iF(e,t,n){return iO.apply(this,arguments)}function iO(){return(iO=(0,h.Z)(k().mark(function e(t,n,r){var i,a,o;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=iG.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=iQ.bind(null,e),e}(t),e.prev=1,e.next=4,function(e,t){var n,r,i=ee.now(),a=t.reduce(function(e,t){return e.add(t.key)},tV());return e.persistence.runTransaction("Locally write mutations","readwrite",function(o){var u=tS,s=tV();return e.os.getEntries(o,a).next(function(e){(u=e).forEach(function(e,t){t.isValidDocument()||(s=s.add(e))})}).next(function(){return e.localDocuments.getOverlayedDocuments(o,u)}).next(function(r){n=r;var a,u=[],s=A(t);try{for(s.s();!(a=s.n()).done;){var c=a.value,l=function(e,t){var n,r=null,i=A(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t.data.field(a.field),u=tq(a.transform,o||null);null!=u&&(null===r&&(r=eJ.empty()),r.set(a.field,u))}}catch(e){i.e(e)}finally{i.f()}return r||null}(c,n.get(c.key).overlayedDocument);null!=l&&u.push(new t4(c.key,l,function e(t){var n=[];return eg(t.fields,function(t,r){var i=new ea([t]);if(eH(r)){var a=e(r.mapValue).fields;if(0===a.length)n.push(i);else{var o,u=A(a);try{for(u.s();!(o=u.n()).done;){var s=o.value;n.push(i.child(s))}}catch(e){u.e(e)}finally{u.f()}}}else n.push(i)}),new eb(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(l.value.mapValue),tX.exists(!0)))}}catch(e){s.e(e)}finally{s.f()}return e.mutationQueue.addMutationBatch(o,i,u,t)}).next(function(t){r=t;var i=t.applyToLocalDocumentSet(n,s);return e.documentOverlayCache.saveOverlays(o,t.batchId,i)})}).then(function(){return{batchId:r.batchId,changes:tZ(n)}})}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),!function(e,t,n){var r=e.xa[e.currentUser.toKey()];r||(r=new ew(J)),r=r.insert(t,n),e.xa[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,i0(i,a.changes);case 9:return e.next=11,rH(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),o=ii(e.t0,"Failed to persist write"),r.reject(o);case 17:case"end":return e.stop()}},e,null,[[1,13]])}))).apply(this,arguments)}function iP(e,t){return iU.apply(this,arguments)}function iU(){return(iU=(0,h.Z)(k().mark(function e(t,n){var r,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,e.prev=1,e.next=4,function(e,t){var n=t.snapshotVersion,r=e.ns;return e.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var a=e.os.newChangeBuffer({trackRemovals:!0});r=e.ns;var o=[];t.targetChanges.forEach(function(a,u){var s=r.get(u);if(s){o.push(e.Qr.removeMatchingKeys(i,a.removedDocuments,u).next(function(){return e.Qr.addMatchingKeys(i,a.addedDocuments,u)}));var c,l=s.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(u)?l=l.withResumeToken(eA.EMPTY_BYTE_STRING,et.min()).withLastLimboFreeSnapshotVersion(et.min()):a.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(a.resumeToken,n)),r=r.insert(u,l),c=l,(0===s.resumeToken.approximateByteSize()||c.snapshotVersion.toMicroseconds()-s.snapshotVersion.toMicroseconds()>=3e8||a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size>0)&&o.push(e.Qr.updateTargetData(i,l))}});var u=tS,s=tV();if(t.documentUpdates.forEach(function(n){t.resolvedLimboDocuments.has(n)&&o.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),o.push((function(e,t,n){var r=tV(),i=tV();return n.forEach(function(e){return r=r.add(e)}),t.getEntries(e,r).next(function(e){var r=tS;return n.forEach(function(n,a){var o=e.get(n);a.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(et.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!o.isValidDocument()||a.version.compareTo(o.version)>0||0===a.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):M("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",a.version)}),{cs:r,ls:i}})})(i,a,t.documentUpdates).next(function(e){u=e.cs,s=e.ls})),!n.isEqual(et.min())){var c=e.Qr.getLastRemoteSnapshotVersion(i).next(function(t){return e.Qr.setTargetsMetadata(i,i.currentSequenceNumber,n)});o.push(c)}return ef.waitFor(o).next(function(){return a.apply(i)}).next(function(){return e.localDocuments.getLocalViewOfDocuments(i,u,s)}).next(function(){return u})}).then(function(t){return e.ns=r,t})}(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach(function(e,t){var n=r.Fa.get(t);n&&(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1||P(),e.addedDocuments.size>0?n.wa=!0:e.modifiedDocuments.size>0?n.wa||P():e.removedDocuments.size>0&&(n.wa||P(),n.wa=!1))}),e.next=8,i0(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,el(e.t0);case 14:case"end":return e.stop()}},e,null,[[1,10]])}))).apply(this,arguments)}function iq(e,t,n){if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){var r,i,a=[];e.ba.forEach(function(e,n){var r=n.view.j_(t);r.snapshot&&a.push(r.snapshot)}),(r=e.eventManager).onlineState=t,i=!1,r.queries.forEach(function(e,n){var r,a=A(n.U_);try{for(a.s();!(r=a.n()).done;)r.value.j_(t)&&(i=!0)}catch(e){a.e(e)}finally{a.f()}}),i&&im(r),a.length&&e.Sa.h_(a),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}function iB(e,t,n){return iz.apply(this,arguments)}function iz(){return(iz=(0,h.Z)(k().mark(function e(t,n,r){var i,a,o,u,s,c;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((i=t).sharedClientState.updateQueryState(n,"rejected",r),!(o=(a=i.Fa.get(n))&&a.key)){e.next=14;break}return u=(u=new ew(eo.comparator)).insert(o,e$.newNoDocument(o,et.min())),s=tV().add(o),c=new nl(et.min(),new Map,new ew(J),u,s),e.next=9,iP(i,c);case 9:i.va=i.va.remove(o),i.Fa.delete(n),i$(i),e.next=16;break;case 14:return e.next=16,ri(i.localStore,n,!1).then(function(){return iY(i,n,r)}).catch(el);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function iG(e,t){return iK.apply(this,arguments)}function iK(){return(iK=(0,h.Z)(k().mark(function e(t,n){var r,i,a;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,i=n.batch.batchId,e.prev=1,e.next=4,function(e,t){return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r,i,a,o=t.batch.keys(),u=e.os.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),a=ef.resolve(),i.forEach(function(e){a=a.next(function(){return u.getEntry(n,e)}).next(function(n){var i=t.docVersions.get(e);null!==i||P(),0>n.version.compareTo(i)&&(r.applyToRemoteDocument(n,t),n.isValidDocument()&&(n.setReadTime(t.commitVersion),u.addEntry(n)))})}),a.next(function(){return e.mutationQueue.removeMutationBatch(n,r)})).next(function(){return u.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.documentOverlayCache.removeOverlaysForBatchId(n,o,t.batch.batchId)}).next(function(){return e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(e){for(var t=tV(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))}).next(function(){return e.localDocuments.getDocuments(n,o)})})}(r.localStore,n);case 4:return a=e.sent,iH(r,i,null),iW(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,i0(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,el(e.t0);case 16:case"end":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function iQ(e,t,n){return ij.apply(this,arguments)}function ij(){return(ij=(0,h.Z)(k().mark(function e(t,n,r){var i,a;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t,e.prev=1,e.next=4,function(e,t){return e.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return null!==t||P(),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.documentOverlayCache.removeOverlaysForBatchId(n,r,t)}).next(function(){return e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,r)}).next(function(){return e.localDocuments.getDocuments(n,r)})})}(i.localStore,n);case 4:return a=e.sent,iH(i,n,r),iW(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,i0(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,el(e.t0);case 16:case"end":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function iW(e,t){(e.Oa.get(t)||[]).forEach(function(e){e.resolve()}),e.Oa.delete(t)}function iH(e,t,n){var r=e.xa[e.currentUser.toKey()];if(r){var i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.xa[e.currentUser.toKey()]=r}}function iY(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=A(e.Da.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.ba.delete(a),n&&e.Sa.ka(a,n)}}catch(e){i.e(e)}finally{i.f()}e.Da.delete(t),e.isPrimaryClient&&e.Ma.Vr(t).forEach(function(t){e.Ma.containsKey(t)||iX(e,t)})}function iX(e,t){e.Ca.delete(t.path.canonicalString());var n=e.va.get(t);null!==n&&(rZ(e.remoteStore,n),e.va=e.va.remove(t),e.Fa.delete(n),i$(e))}function iJ(e,t,n){var r,i=A(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof ik?(e.Ma.addReference(a.key,t),function(e,t){var n=t.key,r=n.path.canonicalString();e.va.get(n)||e.Ca.has(r)||(M("SyncEngine","New document in limbo: "+n),e.Ca.add(r),i$(e))}(e,a)):a instanceof iw?(M("SyncEngine","Document no longer in limbo: "+a.key),e.Ma.removeReference(a.key,t),e.Ma.containsKey(a.key)||iX(e,a.key)):P()}}catch(e){i.e(e)}finally{i.f()}}function i$(e){for(;e.Ca.size>0&&e.va.size<e.maxConcurrentLimboResolutions;){var t=e.Ca.values().next().value;e.Ca.delete(t);var n=new eo(er.fromString(t)),r=e.Na.next();e.Fa.set(r,new iT(n)),e.va=e.va.insert(n,r),rD(e.remoteStore,new nP(tw(new ty(n.path)),r,"TargetPurposeLimboResolution",ev.oe))}}function i0(e,t,n){return i1.apply(this,arguments)}function i1(){return(i1=(0,h.Z)(k().mark(function e(t,n,r){var i,a,o,u;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t,a=[],o=[],u=[],e.t0=i.ba.isEmpty(),e.t0){e.next=9;break}return i.ba.forEach(function(e,t){u.push(i.Ba(t,n,r).then(function(e){if((e||r)&&i.isPrimaryClient){var n=e&&!e.fromCache;i.sharedClientState.updateQueryState(t.targetId,n?"current":"not-current")}if(e){a.push(e);var u=n9.Ki(t.targetId,e);o.push(u)}}))}),e.next=6,Promise.all(u);case 6:return i.Sa.h_(a),e.next=9,(function(){var e=(0,h.Z)(k().mark(function e(t,n){var r,i,a,o,u,s,c,l;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return ef.forEach(n,function(t){return ef.forEach(t.qi,function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)}).next(function(){return ef.forEach(t.Qi,function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)})})})});case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),ed(e.t0)){e.next=10;break}throw e.t0;case 10:M("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=A(n);try{for(i.s();!(a=i.n()).done;)u=(o=a.value).targetId,o.fromCache||(c=(s=r.ns.get(u)).snapshotVersion,l=s.withLastLimboFreeSnapshotVersion(c),r.ns=r.ns.insert(u,l))}catch(e){i.e(e)}finally{i.f()}case 13:case"end":return e.stop()}},e,null,[[1,6]])}));return function(t,n){return e.apply(this,arguments)}})()(i.localStore,o);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function i2(e,t){return i3.apply(this,arguments)}function i3(){return(i3=(0,h.Z)(k().mark(function e(t,n){var r,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t).currentUser.isEqual(n)){e.next=11;break}return M("SyncEngine","User change. New user:",n.toKey()),e.next=5,re(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,!function(e,t){e.Oa.forEach(function(e){e.forEach(function(e){e.reject(new q(U.CANCELLED,t))})}),e.Oa.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,i0(r,i.us);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function i4(e,t){var n=e.Fa.get(t);if(n&&n.wa)return tV().add(n.key);var r=tV(),i=e.Da.get(t);if(!i)return r;var a,o=A(i);try{for(o.s();!(a=o.n()).done;){var u=a.value,s=e.ba.get(u);r=r.unionWith(s.view.Ea)}}catch(e){o.e(e)}finally{o.f()}return r}function i5(){return(i5=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,n){var r,i,a;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,e.next=3,ro(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.pa(i),e.abrupt("return",(r.isPrimaryClient&&iJ(r,n.targetId,a.fa),a));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function i9(){return(i9=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,n,r){var i,a,o,u,s,c,l,h,f,d,v,y,p,m;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=t,a=[],o=[],u=A(n),e.prev=2,u.s();case 4:if((s=u.n()).done){e.next=45;break}if(c=s.value,l=void 0,!((h=i.Da.get(c))&&0!==h.length)){e.next=34;break}return e.next=11,rr(i.localStore,tw(h[0]));case 11:l=e.sent,f=A(h),e.prev=13,f.s();case 15:if((d=f.n()).done){e.next=24;break}return v=d.value,y=i.ba.get(v),e.next=20,function(e,t){return i5.apply(this,arguments)}(i,y);case 20:(p=e.sent).snapshot&&o.push(p.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),f.e(e.t0);case 29:return e.prev=29,f.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,function(e,t){var n=e.Qr,r=e.ns.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",function(e){return n.ot(e,t).next(function(e){return e?e.target:null})})}(i.localStore,c);case 36:return m=e.sent,e.next=39,rr(i.localStore,m);case 39:return l=e.sent,e.next=42,iD(i,function(e){var t,n,r,i;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,new ty(t,n,r,i,e.limit,"F",e.startAt,e.endAt)}(m),c,!1,l.resumeToken);case 42:a.push(l);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),u.e(e.t1);case 50:return e.prev=50,u.f(),e.finish(50);case 53:return e.abrupt("return",(i.Sa.h_(o),a));case 54:case"end":return e.stop()}},e,null,[[2,47,50,53],[13,26,29,32]])}))).apply(this,arguments)}function i6(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=iP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=i4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=iB.bind(null,e),e.Sa.h_=iy.bind(null,e.eventManager),e.Sa.ka=ip.bind(null,e.eventManager),e}var i8=function(){var e,t;function n(){(0,p.Z)(this,n),this.synchronizeTabs=!1}return(0,m.Z)(n,[{key:"initialize",value:(e=(0,h.Z)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.serializer=rk(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),e.next=5,this.persistence.start();case 5:this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore);case 8:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"createGarbageCollectionScheduler",value:function(e,t){return null}},{key:"createIndexBackfillerScheduler",value:function(e,t){return null}},{key:"createLocalStore",value:function(e){var t;return t=this.persistence,new n7(t,new n8,e.initialUser,this.serializer)}},{key:"createPersistence",value:function(e){return new n3(n5.Hr,this.serializer)}},{key:"createSharedClientState",value:function(e){return new rc}},{key:"terminate",value:(t=(0,h.Z)(k().mark(function e(){var t,n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(n=this.indexBackfillerScheduler)||void 0===n||n.stop(),this.sharedClientState.shutdown(),e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),n}(),i7=function(){var e,t;function n(){(0,p.Z)(this,n)}return(0,m.Z)(n,[{key:"initialize",value:(e=(0,h.Z)(k().mark(function e(t,n){var r=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return iq(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=i2.bind(null,this.syncEngine),e.next=12,function(e,t){return r7.apply(this,arguments)}(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}},e,this)})),function(t,n){return e.apply(this,arguments)})},{key:"createEventManager",value:function(e){return new ic}},{key:"createDatastore",value:function(e){var t=rk(e.databaseInfo.databaseId),n=new rm(e.databaseInfo);return new rI(e.authCredentials,e.appCheckCredentials,n,t)}},{key:"createRemoteStore",value:function(e){var t,n=this;return t=this.localStore,new rx(t,this.datastore,e.asyncQueue,function(e){return iq(n.syncEngine,e,0)},rh.D()?new rh:new rl)}},{key:"createSyncEngine",value:function(e,t){var n,r,i,a,o;return n=this.localStore,r=this.remoteStore,i=this.eventManager,a=this.sharedClientState,o=new iI(n,r,i,a,e.initialUser,e.maxConcurrentLimboResolutions),t&&(o.La=!0),o}},{key:"terminate",value:(t=(0,h.Z)(k().mark(function e(){var t;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(function(){var e=(0,h.Z)(k().mark(function e(t){var n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,M("RemoteStore","RemoteStore shutting down."),n.M_.add(5),e.next=5,rS(n);case 5:n.O_.shutdown(),n.N_.set("Unknown");case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}})()(this.remoteStore);case 2:null===(t=this.datastore)||void 0===t||t.terminate();case 3:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),n}(),ae=function(){function e(t){(0,p.Z)(this,e),this.observer=t,this.muted=!1}return(0,m.Z)(e,[{key:"next",value:function(e){this.observer.next&&this.Ka(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Ka(this.observer.error,e):V("Uncaught Error in snapshot listener:",e.toString())}},{key:"$a",value:function(){this.muted=!0}},{key:"Ka",value:function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)}}]),e}(),at=function(){function e(t,n,r,i){var a,o=this;(0,p.Z)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=D.UNAUTHENTICATED,this.clientId=X.newId(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,(a=(0,h.Z)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return M("FirestoreClient","Received user=",t.uid),e.next=3,o.authCredentialListener(t);case 3:o.user=t;case 4:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)})),this.appCheckCredentials.start(r,function(e){return M("FirestoreClient","Received new app check token=",e),o.appCheckCredentialListener(e,o.user)})}return(0,m.Z)(e,[{key:"configuration",get:function(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new q(U.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new B;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,h.Z)(k().mark(function n(){var r;return k().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e._onlineComponents,!n.t0){n.next=5;break}return n.next=5,e._onlineComponents.terminate();case 5:if(n.t1=e._offlineComponents,!n.t1){n.next=9;break}return n.next=9,e._offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=ii(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}},n,null,[[0,14]])}))),t.promise}}]),e}();function an(e,t){return ar.apply(this,arguments)}function ar(){return(ar=(0,h.Z)(k().mark(function e(t,n){var r,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),M("FirestoreClient","Initializing OfflineComponentProvider"),r=t.configuration,e.next=4,n.initialize(r);case 4:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,h.Z)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,re(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t._offlineComponents=n;case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ai(e,t){return aa.apply(this,arguments)}function aa(){return(aa=(0,h.Z)(k().mark(function e(t,n){var r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,function(e){return ao.apply(this,arguments)}(t);case 3:return r=e.sent,M("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,n.initialize(r,t.configuration);case 7:t.setCredentialChangeListener(function(e){return r6(n.remoteStore,e)}),t.setAppCheckTokenChangeListener(function(e,t){return r6(n.remoteStore,t)}),t._onlineComponents=n;case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ao(){return(ao=(0,h.Z)(k().mark(function e(t){var n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t._offlineComponents){e.next=21;break}if(!t._uninitializedComponentsProvider){e.next=18;break}return M("FirestoreClient","Using user provided OfflineComponentProvider"),e.prev=3,e.next=6,an(t,t._uninitializedComponentsProvider._offline);case 6:e.next=16;break;case 8:var r;if(e.prev=8,e.t0=e.catch(3),"FirebaseError"===(r=n=e.t0).name?r.code===U.FAILED_PRECONDITION||r.code===U.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code){e.next=13;break}throw n;case 13:return F("Error using user provided cache. Falling back to memory cache: "+n),e.next=16,an(t,new i8);case 16:e.next=21;break;case 18:return M("FirestoreClient","Using default OfflineComponentProvider"),e.next=21,an(t,new i8);case 21:return e.abrupt("return",t._offlineComponents);case 22:case"end":return e.stop()}},e,null,[[3,8]])}))).apply(this,arguments)}function au(e){return as.apply(this,arguments)}function as(){return(as=(0,h.Z)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t._onlineComponents,e.t0){e.next=11;break}if(!t._uninitializedComponentsProvider){e.next=8;break}return M("FirestoreClient","Using user provided OnlineComponentProvider"),e.next=6,ai(t,t._uninitializedComponentsProvider._online);case 6:e.next=11;break;case 8:return M("FirestoreClient","Using default OnlineComponentProvider"),e.next=11,ai(t,new i7);case 11:return e.abrupt("return",t._onlineComponents);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ac(e){return al.apply(this,arguments)}function al(){return(al=(0,h.Z)(k().mark(function e(t){var n,r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,au(t);case 2:return r=(n=e.sent).eventManager,e.abrupt("return",(r.onListen=ib.bind(null,n.syncEngine),r.onUnlisten=iR.bind(null,n.syncEngine),r.onFirstRemoteStoreListen=iA.bind(null,n.syncEngine),r.onLastRemoteStoreUnlisten=iM.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ah(e){var t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var af=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ad(e,t,n){if(!n)throw new q(U.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function av(e){if(!eo.isDocumentKey(e))throw new q(U.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function ay(e){if(eo.isDocumentKey(e))throw new q(U.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function ap(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t,n=(t=e).constructor?t.constructor.name:null;return n?"a custom ".concat(n," object"):"an object"}return"function"==typeof e?"a function":P()}function am(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new q(U.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ap(e);throw new q(U.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}var ag=function(){function e(t){var n,r;if((0,p.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new q(U.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new q(U.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new q(U.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ah(null!==(r=t.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new q(U.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new q(U.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new q(U.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}return(0,m.Z)(e,[{key:"isEqual",value:function(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),ak=function(){function e(t,n,r,i){(0,p.Z)(this,e),this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ag({}),this._settingsFrozen=!1}return(0,m.Z)(e,[{key:"app",get:function(){if(!this._app)throw new q(U.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new q(U.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ag(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new G;switch(e.type){case"firstParty":return new W(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new q(U.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){var e;return(e=af.get(this))&&(M("ComponentProvider","Removing Datastore"),af.delete(this),e.terminate()),Promise.resolve()}}]),e}();function aw(e,t,n){var r,i,a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=(e=am(e,ak))._getSettings(),s="".concat(t,":").concat(n);if("firestore.googleapis.com"!==u.host&&u.host!==s&&F("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},u),{host:s,ssl:!1})),o.mockUserToken){if("string"==typeof o.mockUserToken)i=o.mockUserToken,a=D.MOCK_USER;else{i=(0,T.Sg)(o.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var c=o.mockUserToken.sub||o.mockUserToken.user_id;if(!c)throw new q(U.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new D(c)}e._authCredentials=new K(new z(i,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var a_=function(){function e(t,n,r){(0,p.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,m.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),aE=function(){function e(t,n,r){(0,p.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,m.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new aT(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),aT=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i){var a;return(0,p.Z)(this,n),(a=t.call(this,e,r,new ty(i)))._path=i,a.type="collection",a}return(0,m.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new aE(this.firestore,null,new eo(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(a_);function aI(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,T.m9)(e),ad("collection","path",t),e instanceof ak){var a=er.fromString.apply(er,[t].concat(r));return ay(a),new aT(e,null,a)}if(!(e instanceof aE||e instanceof aT))throw new q(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(er.fromString.apply(er,[t].concat(r)));return ay(o),new aT(e.firestore,null,o)}function ab(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,T.m9)(e),1==arguments.length&&(t=X.newId()),ad("doc","path",t),e instanceof ak){var a=er.fromString.apply(er,[t].concat(r));return av(a),new aE(e,null,new eo(a))}if(!(e instanceof aE||e instanceof aT))throw new q(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(er.fromString.apply(er,[t].concat(r)));return av(o),new aE(e.firestore,e instanceof aT?e.converter:null,new eo(o))}var ax=function(){var e,t;function n(){var e=this;(0,p.Z)(this,n),this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new rw(this,"async_queue_retry"),this.hu=function(){var t=rg();t&&M("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Yo.Wo()};var t=rg();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.hu)}return(0,m.Z)(n,[{key:"isShuttingDown",get:function(){return this.ou}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.Pu(),this.Iu(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.ou){this.ou=!0,this.cu=e||!1;var t=rg();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}},{key:"enqueue",value:function(e){var t=this;if(this.Pu(),this.ou)return new Promise(function(){});var n=new B;return this.Iu(function(){return t.ou&&t.cu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget(function(){return t.su.push(e),t.Tu()})}},{key:"Tu",value:(e=(0,h.Z)(k().mark(function e(){var t=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0!==this.su.length)){e.next=14;break}return e.prev=1,e.next=4,this.su[0]();case 4:this.su.shift(),this.Yo.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),ed(e.t0)){e.next=12;break}throw e.t0;case 12:M("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.su.length>0&&this.Yo.$o(function(){return t.Tu()});case 14:case"end":return e.stop()}},e,this,[[1,8]])})),function(){return e.apply(this,arguments)})},{key:"Iu",value:function(e){var t=this,n=this.iu.then(function(){return t.uu=!0,e().catch(function(e){var n;throw t.au=e,t.uu=!1,V("INTERNAL UNHANDLED ERROR: ",(n=e.message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),e}).then(function(e){return t.uu=!1,e})});return this.iu=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.Pu(),this.lu.indexOf(e)>-1&&(t=0);var i=ir.createAndSchedule(this,e,t,n,function(e){return r.Eu(e)});return this._u.push(i),i}},{key:"Pu",value:function(){this.au&&P()}},{key:"verifyOperationInProgress",value:function(){}},{key:"du",value:(t=(0,h.Z)(k().mark(function e(){var t;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.iu,e.next=3,t;case 3:if(t!==this.iu){e.next=0;break}case 4:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"Au",value:function(e){var t,n=A(this._u);try{for(n.s();!(t=n.n()).done;)if(t.value.timerId===e)return!0}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"Ru",value:function(e){var t=this;return this.du().then(function(){t._u.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});var n,r=A(t._u);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(e){r.e(e)}finally{r.f()}return t.du()})}},{key:"Vu",value:function(e){this.lu.push(e)}},{key:"Eu",value:function(e){var t=this._u.indexOf(e);this._u.splice(t,1)}}]),n}(),aA=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i,a){var o;return(0,p.Z)(this,n),(o=t.call(this,e,r,i,a)).type="firestore",o._queue=new ax,o._persistenceKey=(null==a?void 0:a.name)||"[DEFAULT]",o}return(0,m.Z)(n,[{key:"_terminate",value:function(){return this._firestoreClient||aN(this),this._firestoreClient.terminate()}}]),n}(ak);function aC(e,t){var n="object"==typeof e?e:(0,w.Mq)(),r=(0,w.qX)(n,"firestore").getImmediate({identifier:"string"==typeof e?e:t||"(default)"});if(!r._initialized){var i=(0,T.P0)("firestore");i&&aw.apply(void 0,[r].concat((0,y.Z)(i)))}return r}function aS(e){return e._firestoreClient||aN(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function aN(e){var t,n,r,i,a=e._freezeSettings(),o=(t=e._databaseId,new eM(t,(null===(n=e._app)||void 0===n?void 0:n.options.appId)||"",e._persistenceKey,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,ah(a.experimentalLongPollingOptions),a.useFetchStreams));e._firestoreClient=new at(e._authCredentials,e._appCheckCredentials,e._queue,o),(null===(r=a.localCache)||void 0===r?void 0:r._offlineComponentProvider)&&(null===(i=a.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:a.localCache.kind,_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider})}var aD=function(){function e(t){(0,p.Z)(this,e),this._byteString=t}return(0,m.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(eA.fromBase64String(t))}catch(e){throw new q(U.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}},{key:"fromUint8Array",value:function(t){return new e(eA.fromUint8Array(t))}}]),e}(),aZ=function(){function e(){(0,p.Z)(this,e);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new q(U.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ea(n)}return(0,m.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}(),aR=(0,m.Z)(function e(t){(0,p.Z)(this,e),this._methodName=t}),aL=function(){function e(t,n){if((0,p.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new q(U.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new q(U.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,m.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return J(this._lat,e._lat)||J(this._long,e._long)}}]),e}(),aM=/^__.*__$/,aV=function(){function e(t,n,r){(0,p.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,m.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new t4(e,this.data,this.fieldMask,t,this.fieldTransforms):new t3(e,this.data,t,this.fieldTransforms)}}]),e}(),aF=function(){function e(t,n,r){(0,p.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,m.Z)(e,[{key:"toMutation",value:function(e,t){return new t4(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aO(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw P()}}var aP=function(){function e(t,n,r,i,a,o){(0,p.Z)(this,e),this.settings=t,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===a&&this.mu(),this.fieldTransforms=a||[],this.fieldMask=o||[]}return(0,m.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"fu",get:function(){return this.settings.fu}},{key:"gu",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"pu",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.gu({path:n,yu:!1});return r.wu(e),r}},{key:"Su",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.gu({path:n,yu:!1});return r.mu(),r}},{key:"bu",value:function(e){return this.gu({path:void 0,yu:!0})}},{key:"Du",value:function(e){return aX(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})}},{key:"mu",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.wu(this.path.get(e))}},{key:"wu",value:function(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(aO(this.fu)&&aM.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}]),e}(),aU=function(){function e(t,n,r){(0,p.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.serializer=r||rk(t)}return(0,m.Z)(e,[{key:"Fu",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new aP({fu:e,methodName:t,vu:n,path:ea.emptyPath(),yu:!1,Cu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}]),e}();function aq(e){var t=e._freezeSettings(),n=rk(e._databaseId);return new aU(e._databaseId,!!t.ignoreUndefinedProperties,n)}var aB=function(e){(0,f.Z)(n,e);var t=S(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.fu)throw 1===e.fu?e.Du("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Du("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(aR);function az(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return aG(n,e.Fu(r?4:3,t))}function aG(e,t){if(aQ(e=(0,T.m9)(e)))return aj("Unsupported field value:",t,e),aK(e,t);if(e instanceof aR)return function(e,t){if(!aO(t.fu))throw t.Du("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Du("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.yu&&4!==t.fu)throw t.Du("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=A(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,u=aG(o,t.bu(i));null==u&&(u={nullValue:"NULL_VALUE"}),r.push(u),i++}}catch(e){a.e(e)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,T.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e){var n,r,i;return n=t.serializer,"number"==typeof(i=r=e)&&Number.isInteger(i)&&!ey(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?tP(r):tO(n,r)}if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var a=ee.fromDate(e);return{timestampValue:nI(t.serializer,a)}}if(e instanceof ee){var o=new ee(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:nI(t.serializer,o)}}if(e instanceof aL)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof aD)return{bytesValue:nb(t.serializer,e._byteString)};if(e instanceof aE){var u=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(u))throw t.Du("Document reference is for database ".concat(s.projectId,"/").concat(s.database," but should be for database ").concat(u.projectId,"/").concat(u.database));return{referenceValue:nA(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Du("Unsupported field value: ".concat(ap(e)))}(e,t)}function aK(e,t){var n={};return ek(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):eg(e,function(e,r){var i=aG(r,t.pu(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function aQ(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ee||e instanceof aL||e instanceof aD||e instanceof aE||e instanceof aR)}function aj(e,t,n){if(!aQ(n)||!("object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n)))){var r=ap(n);throw"an object"===r?t.Du(e+" a custom object"):t.Du(e+" "+r)}}function aW(e,t,n){if((t=(0,T.m9)(t))instanceof aZ)return t._internalPath;if("string"==typeof t)return aY(e,t);throw aX("Field path arguments must be of type string or ",e,!1,void 0,n)}var aH=RegExp("[~\\*/\\[\\]]");function aY(e,t,n){if(t.search(aH)>=0)throw aX("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,u.Z)(aZ,(0,y.Z)(t.split(".")))._internalPath}catch(r){throw aX("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function aX(e,t,n,r,i){var a=r&&!r.isEmpty(),o=void 0!==i,u="Function ".concat(t,"() called with invalid data");n&&(u+=" (via `toFirestore()`)"),u+=". ";var s="";return(a||o)&&(s+=" (found",a&&(s+=" in field ".concat(r)),o&&(s+=" in document ".concat(i)),s+=")"),new q(U.INVALID_ARGUMENT,u+e+s)}function aJ(e,t){return e.some(function(e){return e.isEqual(t)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var a$=function(){function e(t,n,r,i,a){(0,p.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return(0,m.Z)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new aE(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new a0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(a1("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),a0=function(e){(0,f.Z)(n,e);var t=S(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"data",value:function(){return(0,s.Z)((0,v.Z)(n.prototype),"data",this).call(this)}}]),n}(a$);function a1(e,t){return"string"==typeof t?aY(e,t):t instanceof aZ?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var a2=(0,m.Z)(function e(){(0,p.Z)(this,e)}),a3=function(e){(0,f.Z)(n,e);var t=S(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n)}(a2);function a4(e,t){for(var n=[],r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];t instanceof a2&&n.push(t),function(e){var t=e.filter(function(e){return e instanceof a9}).length,n=e.filter(function(e){return e instanceof a5}).length;if(t>1||t>0&&n>0)throw new q(U.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n=n.concat(i));var o,u=A(n);try{for(u.s();!(o=u.n()).done;)e=o.value._apply(e)}catch(e){u.e(e)}finally{u.f()}return e}var a5=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i){var a;return(0,p.Z)(this,n),(a=t.call(this))._field=e,a._op=r,a._value=i,a.type="where",a}return(0,m.Z)(n,[{key:"_apply",value:function(e){var t=this._parse(e);return oa(e._query,t),new a_(e.firestore,e.converter,t_(e._query,t))}},{key:"_parse",value:function(e){var t=aq(e.firestore);return function(e,t,n,r,i,a,o){var u;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new q(U.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on documentId()."));if("in"===a||"not-in"===a){oi(o,a);var s,c=[],l=A(o);try{for(l.s();!(s=l.n()).done;){var h=s.value;c.push(or(r,e,h))}}catch(e){l.e(e)}finally{l.f()}u={arrayValue:{values:c}}}else u=or(r,e,o)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||oi(o,a),u=az(n,t,o,"in"===a||"not-in"===a);return e5.create(i,a,u)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(a3),a9=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){var i;return(0,p.Z)(this,n),(i=t.call(this)).type=e,i._queryConstraints=r,i}return(0,m.Z)(n,[{key:"_parse",value:function(e){var t=this._queryConstraints.map(function(t){return t._parse(e)}).filter(function(e){return e.getFilters().length>0});return 1===t.length?t[0]:e9.create(t,this._getOperator())}},{key:"_apply",value:function(e){var t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){var n,r=e,i=A(t.getFlattenedFilters());try{for(i.s();!(n=i.n()).done;){var a=n.value;oa(r,a),r=t_(r,a)}}catch(e){i.e(e)}finally{i.f()}}(e._query,t),new a_(e.firestore,e.converter,t_(e._query,t)))}},{key:"_getQueryConstraints",value:function(){return this._queryConstraints}},{key:"_getOperator",value:function(){return"and"===this.type?"and":"or"}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}(a2),a6=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r){var i;return(0,p.Z)(this,n),(i=t.call(this))._field=e,i._direction=r,i.type="orderBy",i}return(0,m.Z)(n,[{key:"_apply",value:function(e){var t,n,r=function(e,t,n){if(null!==e.startAt)throw new q(U.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new q(U.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new e3(t,n)}(e._query,this._field,this._direction);return new a_(e.firestore,e.converter,(n=(t=e._query).explicitOrderBy.concat([r]),new ty(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}(a3);function a8(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=a1("orderBy",e);return a6._create(n,t)}var a7=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i){var a;return(0,p.Z)(this,n),(a=t.call(this)).type=e,a._limit=r,a._limitType=i,a}return(0,m.Z)(n,[{key:"_apply",value:function(e){return new a_(e.firestore,e.converter,tE(e._query,this._limit,this._limitType))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(a3);function oe(e){return function(e,t){if(t<=0)throw new q(U.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */("limit",e),a7._create("limit",e,"F")}var ot=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i){var a;return(0,p.Z)(this,n),(a=t.call(this)).type=e,a._docOrFields=r,a._inclusive=i,a}return(0,m.Z)(n,[{key:"_apply",value:function(e){var t,n=function(e,t,n,r){if(n[0]=(0,T.m9)(n[0]),n[0]instanceof a$)return function(e,t,n,r,i){if(!r)throw new q(U.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,o=[],u=A(tk(e));try{for(u.s();!(a=u.n()).done;){var s=a.value;if(s.field.isKeyField())o.push(eG(t,r.key));else{var c=r.data.field(s.field);if(eZ(c))throw new q(U.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=s.field.canonicalString();throw new q(U.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(l,"' (used as the orderBy) does not exist."))}o.push(c)}}}catch(e){u.e(e)}finally{u.f()}return new e0(o,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=aq(e.firestore);return function(e,t,n,r,i,a){var o=e.explicitOrderBy;if(i.length>o.length)throw new q(U.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var u=[],s=0;s<i.length;s++){var c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new q(U.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!tg(e)&&-1!==c.indexOf("/"))throw new q(U.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(er.fromString(c));if(!eo.isDocumentKey(l))throw new q(U.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var h=new eo(l);u.push(eG(t,h))}else{var f=az(n,r,c);u.push(f)}}return new e0(u,a)}(e._query,e.firestore._databaseId,i,t,n,r)}(e,this.type,this._docOrFields,this._inclusive);return new a_(e.firestore,e.converter,new ty((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt))}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(a3);function on(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return ot._create("startAfter",t,!1)}function or(e,t,n){if("string"==typeof(n=(0,T.m9)(n))){if(""===n)throw new q(U.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!tg(t)&&-1!==n.indexOf("/"))throw new q(U.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(er.fromString(n));if(!eo.isDocumentKey(r))throw new q(U.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return eG(e,new eo(r))}if(n instanceof aE)return eG(e,n._key);throw new q(U.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(ap(n),"."))}function oi(e,t){if(!Array.isArray(e)||0===e.length)throw new q(U.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function oa(e,t){var n=function(e,t){var n,r=A(e);try{for(r.s();!(n=r.n()).done;){var i,a=n.value,o=A(a.getFlattenedFilters());try{for(o.s();!(i=o.n()).done;){var u=i.value;if(t.indexOf(u.op)>=0)return u.op}}catch(e){o.e(e)}finally{o.f()}}}catch(e){r.e(e)}finally{r.f()}return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new q(U.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new q(U.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}var oo=function(){function e(){(0,p.Z)(this,e)}return(0,m.Z)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(eO(e)){case 0:return null;case 1:return e.booleanValue;case 2:return eN(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(eD(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw P()}}},{key:"convertObject",value:function(e,t){return this.convertObjectMap(e.fields,t)}},{key:"convertObjectMap",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",r={};return eg(e,function(e,i){r[e]=t.convertValue(i,n)}),r}},{key:"convertGeoPoint",value:function(e){return new aL(eN(e.latitude),eN(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map(function(e){return n.convertValue(e,t)})}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=eR(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(eL(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=eS(e);return new ee(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=er.fromString(e);nO(n)||P();var r=new eV(n.get(1),n.get(3)),i=new eo(n.popFirst(5));return r.isEqual(t)||V("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}(),ou=function(){function e(t,n){(0,p.Z)(this,e),this.hasPendingWrites=t,this.fromCache=n}return(0,m.Z)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),os=function(e){(0,f.Z)(n,e);var t=S(n);function n(e,r,i,a,o,u){var s;return(0,p.Z)(this,n),(s=t.call(this,e,r,i,a,u))._firestore=e,s._firestoreImpl=e,s.metadata=o,s}return(0,m.Z)(n,[{key:"exists",value:function(){return(0,s.Z)((0,v.Z)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new oc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(a1("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(a$),oc=function(e){(0,f.Z)(n,e);var t=S(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.Z)((0,v.Z)(n.prototype),"data",this).call(this,e)}}]),n}(os),ol=function(){function e(t,n,r,i){(0,p.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new ou(i.hasPendingWrites,i.fromCache),this.query=r}return(0,m.Z)(e,[{key:"docs",get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach(function(r){e.call(t,new oc(n._firestore,n._userDataWriter,r.key,r,new ou(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(U.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map(function(t){var r=new oc(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ou(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);return t.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}})}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(t){var n=new oc(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ou(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return P()}}(t.type),doc:n,oldIndex:i,newIndex:a}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oh(e){e=am(e,aE);var t=am(e.firestore,aA);return(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new B;return e.asyncQueue.enqueueAndForget((0,h.Z)(k().mark(function i(){return k().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new ae({next:function(a){t.enqueueAndForget(function(){return id(e,o)});var u=a.docs.has(n);!u&&a.fromCache?i.reject(new q(U.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&a.fromCache&&r&&"server"===r.source?i.reject(new q(U.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),o=new ig(new ty(n.path),a,{includeMetadataChanges:!0,ra:!0});return il(e,o)},i.next=3,ac(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}},i)}))),r.promise})(aS(t),e._key).then(function(n){var r,i,a;return r=e,i=n.docs.get(r._key),a=new of(t),new os(t,a,r._key,i,new ou(n.hasPendingWrites,n.fromCache),r.converter)})}var of=function(e){(0,f.Z)(n,e);var t=S(n);function n(e){var r;return(0,p.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,m.Z)(n,[{key:"convertBytes",value:function(e){return new aD(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new aE(this.firestore,null,t)}}]),n}(oo);function od(e){e=am(e,a_);var t=am(e.firestore,aA),n=aS(t),r=new of(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new q(U.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new B;return e.asyncQueue.enqueueAndForget((0,h.Z)(k().mark(function i(){return k().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new ig(n,new ae({next:function(n){t.enqueueAndForget(function(){return id(e,a)}),n.fromCache&&"server"===r.source?i.reject(new q(U.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),{includeMetadataChanges:!0,ra:!0});return il(e,a)},i.next=3,ac(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}},i)}))),r.promise})(n,e._query).then(function(n){return new ol(t,r,e,n)})}function ov(e,t,n){e=am(e,aE);for(var r,i,a,o,u,s,c=am(e.firestore,aA),l=aq(c),h=arguments.length,f=Array(h>3?h-3:0),d=3;d<h;d++)f[d-3]=arguments[d];return om(c,[("string"==typeof(t=(0,T.m9)(t))||t instanceof aZ?function(e,t,n,r,i,a){var o=e.Fu(1,t,n),u=[aW(t,r,n)],s=[i];if(a.length%2!=0)throw new q(U.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)u.push(aW(t,a[c])),s.push(a[c+1]);for(var l=[],h=eJ.empty(),f=u.length-1;f>=0;--f)if(!aJ(l,u[f])){var d=u[f],v=s[f];v=(0,T.m9)(v);var y=o.Su(d);if(v instanceof aB)l.push(d);else{var p=aG(v,y);null!=p&&(l.push(d),h.set(d,p))}}return new aF(h,new eb(l),o.fieldTransforms)}(l,"updateDoc",e._key,t,n,f):(r="updateDoc",i=e._key,a=t,aj("Data must be an object, but it was:",o=l.Fu(1,r,i),a),u=[],s=eJ.empty(),eg(a,function(e,t){var n=aY(r,e,i);t=(0,T.m9)(t);var a=o.Su(n);if(t instanceof aB)u.push(n);else{var c=aG(t,a);null!=c&&(u.push(n),s.set(n,c))}}),new aF(s,new eb(u),o.fieldTransforms))).toMutation(e._key,tX.exists(!0))])}function oy(e){return om(am(e.firestore,aA),[new t8(e._key,tX.none())])}function op(e,t){var n,r=am(e.firestore,aA),i=ab(e),a=(n=e.converter)?n.toFirestore(t):t;return om(r,[(function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.Fu(a.merge||a.mergeFields?2:0,t,n,i);aj("Data must be an object, but it was:",o,r);var u=aK(r,o);if(a.merge)s=new eb(o.fieldMask),c=o.fieldTransforms;else if(a.mergeFields){var s,c,l,h=[],f=A(a.mergeFields);try{for(f.s();!(l=f.n()).done;){var d=l.value,v=aW(t,d,n);if(!o.contains(v))throw new q(U.INVALID_ARGUMENT,"Field '".concat(v,"' is specified in your field mask but missing from your input data."));aJ(h,v)||h.push(v)}}catch(e){f.e(e)}finally{f.f()}s=new eb(h),c=o.fieldTransforms.filter(function(e){return s.covers(e.field)})}else s=null,c=o.fieldTransforms;return new aV(new eJ(u),s,c)})(aq(e.firestore),"addDoc",i._key,a,null!==e.converter,{}).toMutation(i._key,tX.exists(!1))]).then(function(){return i})}function om(e,t){var n,r;return n=aS(e),r=new B,n.asyncQueue.enqueueAndForget((0,h.Z)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=iF,e.next=3,au(n).then(function(e){return e.syncEngine});case 3:return e.t1=e.sent,e.t2=t,e.t3=r,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 7:case"end":return e.stop()}},e)}))),r.promise}new WeakMap,function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];Z=w.Jn,(0,w.Xd)(new _.wA("firestore",function(e,n){var r=n.instanceIdentifier,i=n.options,a=e.getProvider("app").getImmediate(),o=new aA(new Q(e.getProvider("auth-internal")),new Y(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new q(U.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new eV(e.options.projectId,t)}(a,r),a);return i=Object.assign({useFetchStreams:t},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),(0,w.KN)(N,"4.6.3",e),(0,w.KN)(N,"4.6.3","esm2017")}()}}]);